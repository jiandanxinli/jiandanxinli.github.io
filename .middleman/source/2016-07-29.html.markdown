---
title: iOSä¸Šç®€æ˜“è½®æ’­å›¾çš„å®ç°
date: 2016-07-29
tags: iOS
author: Qiuncheng
summary: ä»¥ä¸€ä¸ªä¸‰å¼ imageViewçš„è½®æ’­å›¾ä¸ºä¾‹ï¼Œå…·ä½“åˆ°å¦‚ä½•å®ç°è½®æ’­å›¾ï¼Œæ·»åŠ è‡ªåŠ¨è½®æ’­å™¨ï¼Œæ·»åŠ æ‰‹åŠ¿ç‚¹å‡»äº‹ä»¶ç­‰ã€‚
---

### å‰è¨€

è§è¿‡å¾ˆå¤šçš„iOSåº”ç”¨ï¼Œéƒ½æœ‰æ— é™è½®æ’­å›¾ï¼Œä¹‹å‰ä¹Ÿçœ‹åˆ°è¿‡ç›¸å…³å®ç°çš„æ–‡ç« ï¼Œå¯æ˜¯ä»…ä»…å°±æ˜¯ä¸€çœ‹è€Œè¿‡ç½¢äº†ã€‚å½“è‡ªå·±åœ¨é¡¹ç›®ä¸­ç”¨åˆ°è¿™ä¸ªï¼ŒçœŸæ­£å»å†™çš„æ—¶å€™æ‰å‘ç°ä¸æ˜¯å¾ˆå®¹æ˜“ï¼Œé‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œè¿™ç¯‡æ–‡ç« å°±è®°å½•ä¸‹è‡ªå·±æœ€åæˆåŠŸå®ç°è½®æ’­å›¾çš„å†ç¨‹ã€‚

### åŸç†

åŸç†å…¶å®å°±æ˜¯ä¸€ç§å‡è±¡ã€‚ä¸è¿‡åœ¨æˆ‘è¿™é‡Œï¼Œç›®å‰æœ‰è¿‡ä¸¤ç§åŸç†çš„å®ç°ã€‚ä¸€ç§åˆ©ç”¨`UICollectionView`å®ç°è½®æ’­ï¼Œå¦ä¸€ç§åˆ©ç”¨`UIScrollView`å®ç°è½®æ’­ã€‚
ä»Šå¤©æˆ‘ä»¬è¦æ¥æ‰“é€ ä¸€æ¬¾è¿™æ ·çš„è½®æ’­å›¾ï¼ˆå›¾ç”»çš„ä¸å¥½ï¼Œè¯·å‹¿è§æ€ªï¼‰ã€‚

![ä¸¾ä¾‹ï¼šä¸‰å¼ å›¾çš„æ— é™è½®æ’­](https://cloud.githubusercontent.com/assets/9990834/17270175/36fa47a0-568f-11e6-8f3f-bbed783d6b41.png)

#### åŸç†ä¸€ï¼šåˆ©ç”¨`UIScrollView`å®ç°è½®æ’­å›¾ã€‚

è¦æƒ³å®ç°è¿™æ ·çš„æ•ˆæœï¼Œæˆ‘ä»¬ä½¿ç”¨`UIScrollView`åŒ…å«image0ï¼Œimage1ï¼Œimage2çš„ä¸‰ä¸ª`UIImageView`éƒ½æ˜¯æ”¾åœ¨`UIScrollView`é‡Œé¢çš„ï¼Œä½†æ˜¯è¿™æ ·çš„è¯æ˜¯ä¸å¯ä»¥å®ç°è½®æ’­çš„ã€‚è¦æƒ³å®ç°è½®æ’­å°±è¦å†åœ¨è¯¥`UIScrollView`çš„å·¦å³ä¸¤ä¾§å„åŠ ä¸€å¼ `UIImageView`ã€‚åœ¨æœ€åä¸€å¼ æ”¾image0ï¼Œ ç¬¬ä¸€å¼ æ”¾image2ã€‚è¿™æ ·çš„è¯å½“æˆ‘ä»¬æ»šåŠ¨åˆ°æœ€åæˆ–è€…æœ€å‰é¢çš„çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±æŠŠåˆ—è¡¨åˆ‡æ¢åˆ°ç›¸åº”çš„ä½ç½®ï¼Œæ³¨æ„è¿™æ—¶å€™åˆ‡æ¢çš„æ—¶å€™ä¸èƒ½æœ‰åŠ¨ç”»ã€‚åªéœ€è¦è°ƒç”¨`scrollView.contentOffset = CGPoint(...)`å³å¯ã€‚

![å®é™…UISrollViewå›¾](https://cloud.githubusercontent.com/assets/9990834/17270176/408925d4-568f-11e6-9217-e26c3cf09093.png)

#### åŸç†äºŒï¼šåˆ©ç”¨`UICollectionView`å®ç°è½®æ’­å›¾ã€‚

ä½ å½“ç„¶å¯ä»¥åˆ©ç”¨**åŸç†ä¸€**å†ç”¨`UICollectionView`å®ç°ä¸€æ¬¡ã€‚ä½†æ˜¯æˆ‘è¿™é‡Œé‡‡ç”¨ä¸€ç§å·æ‡’çš„æ–¹å¼ï¼Œåˆ©ç”¨`UICollectionView`çš„cellé‡ç”¨æœºåˆ¶ã€‚åˆ›å»ºä¸ªæ— æ•°ä¸ªcellï¼Œæ¯”å¦‚3x20000ã€‚å½“ç”¨æˆ·ç¬¬ä¸€æ¬¡è¿›æ¥çš„æˆ‘ä»¬å°±å°†UICollectionViewæ»‘åˆ°3x20000x0.5çš„ä½ç½®ã€‚ç„¶ååˆ©ç”¨`cell.indexPath.item % 3`æ¥å¯¹cellä¸Šçš„UIImageViewè¿›è¡Œimageæ˜¾ç¤ºã€‚è¿™ç§æ–¹å¼æ¯”è¾ƒå·æ‡’ï¼Œåœ¨åæ¥æ·»åŠ NSTimerè‡ªåŠ¨è½®æ’­å’Œç‚¹å‡»äº‹ä»¶çš„æ—¶å€™ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œä¸è¿‡æœ‰ç‚¹å¤§ç‚®æ‰“å°é¸Ÿçš„æ„Ÿè§‰ã€‚æ‰€ä»¥æˆ‘åœ¨è¿™é‡Œä¹Ÿåªæ˜¯ä»‹ç»ä¸‹åŸç†ï¼Œå¦‚æœä½ æœ‰å…´è¶£ï¼Œå¯ä»¥è‡ªå·±å°è¯•å»å®ç°ä¸‹ã€‚è€Œä¸”UICollectionViewè‡ªå¸¦ä¸€ä¸ªæ–¹æ³•`- scrollToItemAtIndexPath:atScrollPosition:animated:`è¿˜æ¯”è¾ƒå®ç”¨ã€‚

### å…·ä½“å®ç°

é’ˆå¯¹åŸç†ä¸€ï¼Œæˆ‘å°±æ¥ç®€å•å®ç°ä¸‹ã€‚(æˆ‘è¿™é‡Œä½¿ç”¨ä»£ç åˆ›å»º,ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨Storyboardåˆ›å»º,åŸç†ä¸€æ ·)

#### åˆ›å»ºå·¥ç¨‹ï¼Œåˆ›å»º`BannerView.Swift`,æ·»åŠ åˆå§‹åŒ–ä»£ç å¦‚ä¸‹ï¼š

```Swift
/// åˆå§‹åŒ–scrollView
lazy var scrollView: UIScrollView = {
       let scrollView = UIScrollView()
       scrollView.delegate = self
       scrollView.alwaysBounceVertical = false
       scrollView.bounces = true
       scrollView.pagingEnabled = true
       scrollView.scrollEnabled = true
       scrollView.showsVerticalScrollIndicator = false
       scrollView.showsHorizontalScrollIndicator = false
       return scrollView
   }()
/// åˆå§‹åŒ–pageControl
   lazy var pageControl: UIPageControl = {
       let pageControl = UIPageControl()
       pageControl.currentPageIndicatorTintColor = UIColor.redColor()
       pageControl.pageIndicatorTintColor = UIColor.whiteColor()
       return pageControl
   }()

   /// åœ¨inité‡Œè°ƒç”¨setupSubviewså³å¯
   func setupSubviews() {  
       self.addSubview(scrollView)
       self.addSubview(pageControl)

       scrollView.translatesAutoresizingMaskIntoConstraints = false
       pageControl.translatesAutoresizingMaskIntoConstraints = false

       self.addConstraints(NSLayoutConstraint.constraintsWithVisualFormat("V:|[v]|", options: [], metrics: nil, views: ["v": scrollView]))
       self.addConstraints(NSLayoutConstraint.constraintsWithVisualFormat("H:|[v]|", options: [], metrics: nil, views: ["v": scrollView]))

       self.addConstraints(NSLayoutConstraint.constraintsWithVisualFormat("V:[p(==20)]-10-|", options: [], metrics: nil, views: ["p": pageControl]))
       self.addConstraints(NSLayoutConstraint.constraintsWithVisualFormat("H:[p(==100)]-10-|", options: [], metrics: nil, views: ["p": pageControl]))
   }
```

#### åˆå§‹åŒ–UIScrollViewï¼š

```Swift
func setupScrollView() {
        /// åˆ›å»º ï¼ˆimageNames.count + 2ï¼‰ä¸ªUIImageView
        for index in 0 ... (imageNmaes.count + 1) {
            let imageView = UIImageView(frame: CGRect(x: self.width*CGFloat(index), y: 0, width: self.width, height: self.height))
            var picName = String()
            switch index {
            case 0:
                picName = imageNames[imageNames.count-1]
                break
            case imageNames.count + 1:
                picName = imageNames[0]
                break
            default:
                picName = imageNames[index-1]
                break
            }

//          imageView.af_setImageWithURL(NSURL(string: picName)!)
            imageView.image = UIImage(named: picName)
            imageView.contentMode = .ScaleToFill
            imageView.clipsToBounds = true
            imageView.userInteractionEnabled = true
            scrollView.addSubview(imageView)
        }
        scrollView.contentSize = CGSize(width: self.width * CGFloat(imageNames.count + 2), height: self.height)
        scrollView.contentOffset = CGPoint(x: self.width, y: 0)
    }
```
#### æ— é™è½®ç•ªçš„å®ç°ã€‚ï¼ˆé‡ç‚¹ï¼‰ä½¿ç”¨UIScrollViewDelegateåè®®ã€‚
```Swift
func scrollViewDidScroll(scrollView: UIScrollView) {
       if scrollView == self.scrollView {
           let contentOffsetX = scrollView.contentOffset.x
          ///å‘å‰æ»‘åŠ¨åˆ°ç¬¬0å¼ å›¾çš„æ—¶å€™ï¼Œæ»šåˆ°ç¬¬ä¸‰å¼ å›¾
           if contentOffsetX == 0 {
               scrollView.contentOffset = CGPoint(x: self.width * CGFloat(self.imageNames.count), y: 0)
           }
           /// è·‘åˆ°ç¬¬ä¸‰å¼ å›¾çš„æ—¶å€™ï¼Œæ»šåˆ°ç¬¬0å¼ å›¾
           if contentOffsetX == CGFloat(self.imageNames.count + 1)*self.width {
               scrollView.contentOffset = CGPoint(x: self.width, y: 0)
           }
           /// æ”¹å˜pageControlï¼Œè¿™é‡Œè¦æ³¨æ„ï¼Œä¸€å®šè¦ä¸€å®šè¦ä¸€å®šè¦ - 0.5ï¼Œ å› ä¸ºæœ€å‰é¢çš„ç¬¬0å¼ å›¾ä¸€ç›´ä¸æ˜¾ç¤ºã€‚
           let index = scrollView.contentOffset.x / self.width - 0.5
           self.pageControl.currentPage = Int(index)
       }
   }
```

#### æ·»åŠ è®¡æ—¶å™¨

å¥½äº†ï¼Œåšåˆ°è¿™é‡Œï¼Œä½ å·²ç»æˆåŠŸå®ç°äº†è½®æ’­å›¾ï¼Œå¯æ˜¯è¿™ä¸ªè½®æ’­å›¾æ˜¯æ‰‹åŠ¨çš„ï¼Œä¸‹é¢æ·»åŠ è‡ªåŠ¨æ»šåŠ¨ã€‚ä¹Ÿå¾ˆç®€å•ï¼Œè®¾ç½®ä¸€ä¸ªNSTimerè®¡æ—¶å™¨å³å¯ã€‚ä»£ç å¦‚ä¸‹ï¼š

```Swift
// MARK: - Timer
   var timer: NSTimer?
   var i = 1
   /// åœ¨scrollViewä¸Šçš„å›¾ç‰‡æˆåŠŸè®¾ç½®åè°ƒç”¨startTimerå³å¯
   private func startTimer() {
       if timer != nil {
           self.stopTimer()
       }
       /// è¿™é‡Œè®¾ç½®çš„æ»šåŠ¨é—´éš”ä¸º2ç§’
       timer = NSTimer.scheduledTimerWithTimeInterval(2, target: self, selector: #selector(autoScroll), userInfo: nil, repeats: true)
       NSRunLoop.currentRunLoop().addTimer(timer!, forMode: NSEventTrackingRunLoopMode)
       /// è¿™é‡Œä½¿ç”¨äº†NSEventTrackingRunLoopModeæ¨¡å¼ï¼Œé¿å…é¡µé¢æ»šåŠ¨æ—¶timerä¼šåœæ‰ã€‚
   }
   private func stopTimer() {
       timer?.invalidate()
       timer = nil
   }
   func autoScroll() {
       if i == imageNames.count + 1 {
           i = 1
       } else {
           i += 1
       }
       /// åœ¨å¤„ç†æ— é™è½®ç•ªçš„æ—¶å€™è®¾ç½®contentOffsetæ²¡æœ‰æ·»åŠ animatedï¼Œè¿™é‡Œè¦æ·»åŠ ä¸Šæ¥ï¼Œä¸ç„¶æœ‰ç§å¾ˆçªå…€çš„æ„Ÿè§‰ã€‚
       scrollView.setContentOffset(CGPoint(x: self.width * CGFloat(i), y: 0), animated: true)
   }
    /// æ‰‹åŠ¨æ»šåŠ¨ç»“æŸåæ¢å¤è®¡æ—¶
   func scrollViewDidEndDragging(scrollView: UIScrollView, willDecelerate decelerate: Bool) {
        self.startTimer()
    }
    /// å½“æ‰‹åŠ¨æ»šåŠ¨å¼€å§‹æ—¶åœæ­¢è®¡æ—¶
    func scrollViewWillBeginDragging(scrollView: UIScrollView) {
        self.stopTimer()
    }
```

#### æ·»åŠ å…·ä½“ç‚¹å‡»äº‹ä»¶

å…·ä½“åˆ°ç‚¹å‡»äº‹ä»¶çš„è¯ï¼Œæˆ‘æ˜¯æ”¾åœ¨åˆå§‹åŒ–imageViewé‚£é‡Œå¤„ç†çš„ï¼Œç»™imageVIewæ·»åŠ ä¸€ä¸ªUITapGestureRecognizerï¼Œåœ¨è¿™é‡Œæœ€å¥½å†å†™ä¸€ä¸ªä»£ç†æ–¹æ³•ï¼Œå°†imageViewçš„ç‚¹å‡»äº‹ä»¶ä¼ é€’å‡ºå»ã€‚ç„¶åæ ¹æ®å½“å‰`contentOffet.x / self.width`æ¥å°†å…·ä½“å“ªå¼ å›¾ç‰‡çš„äº‹ä»¶ä¼ é€’å‡ºå»ã€‚æˆ‘å°±ä¸ç”¨ä»£ç å±•ç¤ºäº†ã€‚

### ç»“å°¾
æˆ‘è¿™é‡Œä½¿ç”¨äº†ä»£ç æ¥å¸ƒå±€ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨Xibæˆ–è€…Storyboardæ¥å¼„ï¼Œ
è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ã€‚ä½†æ˜¯æˆ‘è¿™ä¸ªå¤ç”¨æ€§æ¯”è¾ƒå·®ï¼Œå°è£…çš„ä¹Ÿä¸å¥½ï¼Œå¯æ˜¯å…·ä½“è¦çœ‹æ€è·¯ğŸ˜‚ã€‚ä»£ç å®ç°æ”¾åœ¨äº†Github Wikiä¸Šäº†[BannerView.Swift](https://github.com/qiuncheng/qiuncheng.github.io/wiki/BannerView.Swift)ï¼Œç”±äºå·¥ç¨‹é‡å¤ªå°ï¼Œå°±æ²¡å°†å·¥ç¨‹æ–‡ä»¶ä¸Šä¼ äº†ã€‚

#### å…³äºä½œè€…

[Qiuncheng](http://qiuncheng.com)ï¼Œä¸€ä½æ­£åœ¨iOSè·¯ä¸Šå‰è¡Œçš„åˆå­¦è€…ï¼Œæ­£åœ¨åŠªåŠ›æˆä¸ºä¸€ååˆæ ¼çš„iOSå¼€å‘è€…ã€‚
