<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ç®€å•å¿ƒç†æŠ€æœ¯å›¢é˜Ÿ</title>
  <subtitle>ç®€å•å¿ƒç† Â· æŠ€æœ¯å›¢é˜Ÿ</subtitle>
  <id>https://jiandanxinli.github.io/</id>
  <link href="https://jiandanxinli.github.io/"/>
  <link href="https://jiandanxinli.github.io/feed.xml" rel="self"/>
  <updated>2016-08-09T08:00:00+08:00</updated>
  <author>
    <name>åŒ—äº¬ç«¹é—´ç§‘æŠ€æœ‰é™å…¬å¸</name>
  </author>
  <entry>
    <title>Express - ç®€å•ä»‹ç» Express</title>
    <link rel="alternate" href="https://jiandanxinli.github.io/2016-08-09.html"/>
    <id>https://jiandanxinli.github.io/2016-08-09.html</id>
    <published>2016-08-09T08:00:00+08:00</published>
    <updated>2016-08-10T10:40:30+08:00</updated>
    <author>
      <name>lei.wang</name>
    </author>
    <content type="html">&lt;p&gt;express æ˜¯ &lt;strong&gt;Node.js&lt;/strong&gt; ä¸Šæœ€æµè¡Œçš„ Web å¼€å‘æ¡†æ¶ï¼Œä½¿ç”¨å®ƒæˆ‘ä»¬å¯ä»¥å¿«é€Ÿçš„å¼€å‘ä¸€ä¸ª Web åº”ç”¨ã€‚&lt;/p&gt;

&lt;p&gt;å®‰è£… express å‘½ä»¤è¡Œå·¥å…·ï¼Œä½¿ç”¨å®ƒæˆ‘ä»¬å¯ä»¥åˆå§‹åŒ–ä¸€ä¸ª express é¡¹ç›®ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src="https://cloud.githubusercontent.com/assets/6661673/17502822/ba3929ca-5e1d-11e6-9aae-ed48653b03cc.jpg" alt="express" /&gt;&lt;/p&gt;

&lt;h2&gt;æ–°å»ºä¸€ä¸ªé¡¹ç›®&lt;/h2&gt;

&lt;p&gt;æ‰§è¡Œ &lt;code&gt;express -e blog&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src="https://cloud.githubusercontent.com/assets/6661673/17502876/137642d4-5e1e-11e6-8df1-08b609f7d670.jpg" alt="new-express" /&gt;&lt;/p&gt;

&lt;p&gt;è¿›å…¥é¡¹ç›®ç›®å½•åæ‰§è¡Œ &lt;code&gt;npm install&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;å®‰è£…å®Œæˆå æ‰§è¡Œ &lt;code&gt;DEBUG=blog:* npm start&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src="https://cloud.githubusercontent.com/assets/6661673/17507925/da030858-5e44-11e6-847a-984bf7a1fbf4.png" alt="image" /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨æµè§ˆå™¨é‡Œè®¿é—® &lt;code&gt;localhost:3000&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;ä½ ä¼šå‘ç°ä¸€ä¸ªç®€å• web åº”ç”¨å·²ç»æ­å»ºèµ·æ¥äº†&lt;/p&gt;

&lt;h2&gt;ç›®å½•ç»“æ„&lt;/h2&gt;

&lt;p&gt;ä½ å¯ä»¥åœ¨ç¬¬ä¸€æ­¥æ‰§è¡Œ &lt;code&gt;express -e blog&lt;/code&gt; åçœ‹åˆ°ä»£ç ç›®å½•ç»“æ„&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;app.jsï¼šå¯åŠ¨æ–‡ä»¶ï¼Œæˆ–è€…è¯´å…¥å£æ–‡ä»¶&lt;/li&gt;
&lt;li&gt;package.jsonï¼šå­˜å‚¨ç€å·¥ç¨‹çš„ä¿¡æ¯åŠæ¨¡å—ä¾èµ–ï¼Œå½“åœ¨ dependencies ä¸­æ·»åŠ ä¾èµ–çš„æ¨¡å—æ—¶ï¼Œè¿è¡Œnpm installï¼Œnpm ä¼šæ£€æŸ¥å½“å‰ç›®å½•ä¸‹çš„ package.jsonï¼Œå¹¶è‡ªåŠ¨å®‰è£…æ‰€æœ‰æŒ‡å®šçš„æ¨¡å—&lt;/li&gt;
&lt;li&gt;node_modulesï¼šå­˜æ”¾ package.json ä¸­å®‰è£…çš„æ¨¡å—ï¼Œå½“ä½ åœ¨ package.json æ·»åŠ ä¾èµ–çš„æ¨¡å—å¹¶å®‰è£…åï¼Œå­˜æ”¾åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹&lt;/li&gt;
&lt;li&gt;publicï¼šå­˜æ”¾ imageã€cssã€js ç­‰æ–‡ä»¶&lt;/li&gt;
&lt;li&gt;routesï¼šå­˜æ”¾è·¯ç”±æ–‡ä»¶&lt;/li&gt;
&lt;li&gt;viewsï¼šå­˜æ”¾è§†å›¾æ–‡ä»¶æˆ–è€…è¯´æ¨¡ç‰ˆæ–‡ä»¶&lt;/li&gt;
&lt;li&gt;binï¼šå­˜æ”¾å¯æ‰§è¡Œæ–‡ä»¶&lt;/li&gt;
&lt;/ul&gt;

&lt;h3&gt;app.js ä¸­çš„ä»£ç &lt;/h3&gt;

&lt;p&gt;&lt;img src="https://cloud.githubusercontent.com/assets/6661673/17502825/bf2e99ce-5e1d-11e6-81fb-8a92b605e3a6.jpg" alt="app" /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨app.jsä¸­æˆ‘ä»¬é€šè¿‡require()åŠ è½½äº†expressã€path ç­‰æ¨¡å—,ä»¥åŠ routes æ–‡ä»¶å¤¹ä¸‹çš„index. jså’Œ users.js è·¯ç”±æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;var app = express()ï¼šç”Ÿæˆä¸€ä¸ªexpresså®ä¾‹ appã€‚&lt;/li&gt;
&lt;li&gt;app.set(&amp;#39;views&amp;#39;, path.join(&lt;strong&gt;dirname, &amp;#39;viewsâ€™))ï¼šè®¾ç½® views æ–‡ä»¶å¤¹ä¸ºå­˜æ”¾viewæ–‡ä»¶çš„ç›®å½•, å³å­˜æ”¾æ¨¡æ¿æ–‡ä»¶çš„åœ°æ–¹,&lt;/strong&gt;dirname ä¸ºå…¨å±€å˜é‡,å­˜å‚¨å½“å‰æ­£åœ¨æ‰§è¡Œçš„è„šæœ¬æ‰€åœ¨çš„ç›®å½•ã€‚&lt;/li&gt;
&lt;li&gt;app.set(&amp;#39;view engine&amp;#39;, &amp;#39;ejsâ€™)ï¼šè®¾ç½®è§†å›¾æ¨¡æ¿å¼•æ“ä¸º ejsã€‚&lt;/li&gt;
&lt;li&gt;app.use(bodyParser.json())ï¼šåŠ è½½è§£æjsonçš„ä¸­é—´ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;app.use(bodyParser.urlencoded({ extended: false }))ï¼šåŠ è½½è§£æurlencodedè¯·æ±‚ä½“çš„ä¸­é—´ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;app.use(cookieParser())ï¼šåŠ è½½è§£æcookieçš„ä¸­é—´ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;app.use(express.static(path.join(__dirname, &amp;#39;public&amp;#39;)))ï¼šè®¾ç½®publicæ–‡ä»¶å¤¹ä¸ºå­˜æ”¾é™æ€æ–‡ä»¶çš„ç›®å½•ã€‚&lt;/li&gt;
&lt;li&gt;app.use(&amp;#39;/&amp;#39;, routes);å’Œapp.use(&amp;#39;/users&amp;#39;, users)ï¼šè·¯ç”±æ§åˆ¶å™¨ã€‚&lt;/li&gt;
&lt;li&gt;æ•è·404é”™è¯¯ï¼Œå¹¶è½¬å‘åˆ°é”™è¯¯å¤„ç†å™¨ã€‚
*&lt;/li&gt;
&lt;/ul&gt;
&lt;pre class="highlight javascript"&gt;&lt;code&gt;  &lt;span class="nx"&gt;app&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;use&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;req&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;next&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;err&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nb"&gt;Error&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'Not Found'&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="nx"&gt;err&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;status&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;404&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="nx"&gt;next&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;err&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;});&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;å¼€å‘ç¯å¢ƒä¸‹çš„é”™è¯¯å¤„ç†å™¨ã€‚
*&lt;/li&gt;
&lt;/ul&gt;
&lt;pre class="highlight javascript"&gt;&lt;code&gt;  &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;app&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'env'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;===&lt;/span&gt; &lt;span class="s1"&gt;'development'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
   &lt;span class="nx"&gt;app&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;use&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;err&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;req&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;next&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
       &lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;status&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;err&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;status&lt;/span&gt; &lt;span class="o"&gt;||&lt;/span&gt; &lt;span class="mi"&gt;500&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
       &lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;render&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'error'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
           &lt;span class="na"&gt;message&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;err&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;message&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
           &lt;span class="na"&gt;error&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;err&lt;/span&gt;
       &lt;span class="p"&gt;});&lt;/span&gt;
   &lt;span class="p"&gt;});&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;ç”Ÿäº§ç¯å¢ƒä¸‹çš„é”™è¯¯å¤„ç†å™¨ã€‚
*&lt;/li&gt;
&lt;/ul&gt;
&lt;pre class="highlight javascript"&gt;&lt;code&gt;  &lt;span class="nx"&gt;app&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;use&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;err&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;req&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;next&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;status&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;err&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;status&lt;/span&gt; &lt;span class="o"&gt;||&lt;/span&gt; &lt;span class="mi"&gt;500&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;render&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'error'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="na"&gt;message&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;err&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;message&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="na"&gt;error&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{}&lt;/span&gt;
    &lt;span class="p"&gt;});&lt;/span&gt;
  &lt;span class="p"&gt;});&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;module.exports = app ï¼šå¯¼å‡ºappå®ä¾‹ä¾›å…¶ä»–æ¨¡å—è°ƒç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;è·¯ç”±è§„åˆ™&lt;/h2&gt;

&lt;p&gt;express å°è£…äº†å¤šç§ http è¯·æ±‚æ–¹å¼ï¼Œæˆ‘ä»¬ä¸»è¦åªä½¿ç”¨ &lt;code&gt;get&lt;/code&gt; å’Œ &lt;code&gt;post&lt;/code&gt; ä¸¤ç§ï¼Œå³ &lt;code&gt;app.get()&lt;/code&gt; å’Œ &lt;code&gt;app.post()&lt;/code&gt; ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;app.get()&lt;/code&gt; å’Œ &lt;code&gt;app.post()&lt;/code&gt; çš„ç¬¬ä¸€ä¸ªå‚æ•°éƒ½ä¸ºè¯·æ±‚çš„è·¯å¾„ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºå¤„ç†è¯·æ±‚çš„å›è°ƒå‡½æ•°ï¼Œå›è°ƒå‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯ &lt;code&gt;req&lt;/code&gt; å’Œ &lt;code&gt;res&lt;/code&gt;ï¼Œä»£è¡¨è¯·æ±‚ä¿¡æ¯å’Œå“åº”ä¿¡æ¯ã€‚è·¯å¾„è¯·æ±‚åŠå¯¹åº”çš„è·å–è·¯å¾„æœ‰ä»¥ä¸‹å‡ ç§å½¢å¼ï¼š
  * &lt;code&gt;req.query&lt;/code&gt;ï¼š å¤„ç† &lt;code&gt;get&lt;/code&gt; è¯·æ±‚ï¼Œè·å– &lt;code&gt;get&lt;/code&gt; è¯·æ±‚å‚æ•°
  * &lt;code&gt;req.params&lt;/code&gt;ï¼š å¤„ç† &lt;code&gt;/:xxx&lt;/code&gt; å½¢å¼çš„ &lt;code&gt;get&lt;/code&gt; æˆ– &lt;code&gt;post&lt;/code&gt; è¯·æ±‚ï¼Œè·å–è¯·æ±‚å‚æ•°
  * &lt;code&gt;req.body&lt;/code&gt;ï¼š å¤„ç† &lt;code&gt;post&lt;/code&gt; è¯·æ±‚ï¼Œè·å– &lt;code&gt;post&lt;/code&gt; è¯·æ±‚ä½“
  * &lt;code&gt;req.param()&lt;/code&gt;ï¼š å¤„ç† &lt;code&gt;get&lt;/code&gt; å’Œ &lt;code&gt;post&lt;/code&gt; è¯·æ±‚ï¼Œä½†æŸ¥æ‰¾ä¼˜å…ˆçº§ç”±é«˜åˆ°ä½ä¸º &lt;code&gt;req.params&lt;/code&gt;â†’&lt;code&gt;req.body&lt;/code&gt;â†’&lt;code&gt;req.query&lt;/code&gt;&lt;/p&gt;
&lt;pre class="highlight javascript"&gt;&lt;code&gt;  &lt;span class="cm"&gt;/* GET home page. */&lt;/span&gt;
  &lt;span class="nx"&gt;router&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'/'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;req&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;next&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="c1"&gt;// ?name=111&amp;amp;phone=111&lt;/span&gt;
    &lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;req&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;query&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="c1"&gt;// =&amp;gt; { name: '111', phone: '111' }&lt;/span&gt;

    &lt;span class="c1"&gt;// ?name=111&amp;amp;user[phone]=111&lt;/span&gt;
    &lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;req&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;query&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="c1"&gt;// =&amp;gt; { name: '111', user: { phone: '111' } }&lt;/span&gt;

    &lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;render&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'index'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="na"&gt;title&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'Express'&lt;/span&gt; &lt;span class="p"&gt;});&lt;/span&gt;
  &lt;span class="p"&gt;});&lt;/span&gt;

  &lt;span class="nx"&gt;router&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;post&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'/post'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;req&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;next&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="c1"&gt;// post name=1111&amp;amp;phone=1111&lt;/span&gt;
    &lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;req&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;body&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="c1"&gt;// =&amp;gt; { name: '1111', phone: '1111' }&lt;/span&gt;

    &lt;span class="c1"&gt;// post user[name]=1111&amp;amp;user[phone]=1111&lt;/span&gt;
    &lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;req&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;body&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="c1"&gt;// =&amp;gt; { user: { name : '1111', phone: '1111' } }&lt;/span&gt;

    &lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;render&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'index'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="na"&gt;title&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'Express'&lt;/span&gt; &lt;span class="p"&gt;});&lt;/span&gt;
  &lt;span class="p"&gt;});&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;æ¨¡ç‰ˆå¼•æ“&lt;/h2&gt;

&lt;h3&gt;ä»€ä¹ˆæ˜¯æ¨¡æ¿å¼•æ“&lt;/h3&gt;

&lt;p&gt;æ¨¡æ¿å¼•æ“ï¼ˆTemplate Engineï¼‰æ˜¯ä¸€ä¸ªå°†é¡µé¢æ¨¡æ¿å’Œè¦æ˜¾ç¤ºçš„æ•°æ®ç»“åˆèµ·æ¥ç”Ÿæˆ HTML é¡µé¢çš„å·¥å…·ã€‚
å¦‚æœè¯´ä¸Šé¢è®²åˆ°çš„ express ä¸­çš„è·¯ç”±æ§åˆ¶æ–¹æ³•ç›¸å½“äº MVC ä¸­çš„æ§åˆ¶å™¨çš„è¯ï¼Œé‚£æ¨¡æ¿å¼•æ“å°±ç›¸å½“äº MVC ä¸­çš„è§†å›¾ã€‚&lt;/p&gt;

&lt;p&gt;ä»€ä¹ˆæ˜¯ ejs ?&lt;/p&gt;

&lt;p&gt;ejs æ˜¯æ¨¡æ¿å¼•æ“çš„ä¸€ç§ï¼Œå› ä¸ºå®ƒä½¿ç”¨èµ·æ¥ååˆ†ç®€å•ï¼Œè€Œä¸”ä¸ express é›†æˆè‰¯å¥½ã€‚&lt;/p&gt;

&lt;h3&gt;ä½¿ç”¨æ¨¡æ¿å¼•æ“&lt;/h3&gt;

&lt;p&gt;é€šè¿‡ä»¥ä¸‹ä¸¤è¡Œä»£ç è®¾ç½®äº†æ¨¡æ¿æ–‡ä»¶çš„å­˜å‚¨ä½ç½®å’Œä½¿ç”¨çš„æ¨¡æ¿å¼•æ“ï¼š&lt;/p&gt;
&lt;pre class="highlight javascript"&gt;&lt;code&gt;&lt;span class="nx"&gt;app&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;set&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'views'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;__dirname&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;'/views'&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="nx"&gt;app&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;set&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'view engine'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'ejs'&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æˆ‘ä»¬é€šè¿‡ &lt;code&gt;express -e blog&lt;/code&gt; åªæ˜¯åˆå§‹åŒ–äº†ä¸€ä¸ªä½¿ç”¨ &lt;code&gt;ejs&lt;/code&gt; æ¨¡æ¿å¼•æ“çš„å·¥ç¨‹è€Œå·²ï¼Œæ¯”å¦‚ &lt;code&gt;node_modules&lt;/code&gt; ä¸‹æ·»åŠ äº† &lt;code&gt;ejs&lt;/code&gt; æ¨¡å—ï¼Œ&lt;code&gt;views&lt;/code&gt; æ–‡ä»¶å¤¹ä¸‹æœ‰ &lt;code&gt;index.ejs&lt;/code&gt; ã€‚å¹¶ä¸æ˜¯è¯´å¼ºåˆ¶è¯¥å·¥ç¨‹åªèƒ½ä½¿ç”¨ &lt;code&gt;ejs&lt;/code&gt; ä¸èƒ½ä½¿ç”¨å…¶ä»–çš„æ¨¡æ¿å¼•æ“æ¯”å¦‚ &lt;code&gt;jade&lt;/code&gt;ï¼ŒçœŸæ­£æŒ‡å®šä½¿ç”¨å“ªä¸ªæ¨¡æ¿å¼•æ“çš„æ˜¯ &lt;code&gt;app.set(&amp;#39;view engine&amp;#39;, &amp;#39;ejs&amp;#39;);&lt;/code&gt; ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨ &lt;code&gt;routes/index.js&lt;/code&gt; ä¸­é€šè¿‡è°ƒç”¨ &lt;code&gt;res.render()&lt;/code&gt; æ¸²æŸ“æ¨¡ç‰ˆï¼Œå¹¶å°†å…¶äº§ç”Ÿçš„é¡µé¢ç›´æ¥è¿”å›ç»™å®¢æˆ·ç«¯ã€‚å®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯æ¨¡æ¿çš„åç§°ï¼Œå³ &lt;code&gt;views&lt;/code&gt; ç›®å½•ä¸‹çš„æ¨¡æ¿æ–‡ä»¶åï¼Œæ‰©å±•å &lt;code&gt;.ejs&lt;/code&gt; å¯é€‰ã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¼ é€’ç»™æ¨¡æ¿çš„æ•°æ®å¯¹è±¡ï¼Œç”¨äºæ¨¡æ¿ç¿»è¯‘ã€‚&lt;/p&gt;

&lt;p&gt;ejs çš„æ ‡ç­¾ç³»ç»Ÿéå¸¸ç®€å•ï¼Œå®ƒåªæœ‰ä»¥ä¸‹ä¸‰ç§æ ‡ç­¾ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&amp;lt;% code %&amp;gt;ï¼šJavaScript ä»£ç ã€‚&lt;/li&gt;
&lt;li&gt;&amp;lt;%= code %&amp;gt;ï¼šæ˜¾ç¤ºæ›¿æ¢è¿‡ HTML ç‰¹æ®Šå­—ç¬¦çš„å†…å®¹ã€‚&lt;/li&gt;
&lt;li&gt;&amp;lt;%- code %&amp;gt;ï¼šæ˜¾ç¤ºåŸå§‹ HTML å†…å®¹ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;code&gt;&amp;lt;%= code %&amp;gt;&lt;/code&gt; å’Œ &lt;code&gt;&amp;lt;%- code %&amp;gt;&lt;/code&gt; çš„åŒºåˆ«ï¼Œå½“å˜é‡ code ä¸ºæ™®é€šå­—ç¬¦ä¸²æ—¶ï¼Œä¸¤è€…æ²¡æœ‰åŒºåˆ«ã€‚å½“ &lt;code&gt;code&lt;/code&gt; æ¯”å¦‚ä¸º &lt;code&gt;&amp;lt;h1&amp;gt;hello&amp;lt;/h1&amp;gt;&lt;/code&gt; è¿™ç§å­—ç¬¦ä¸²æ—¶ï¼Œ&lt;code&gt;&amp;lt;%= code %&amp;gt;&lt;/code&gt; ä¼šåŸæ ·è¾“å‡º &lt;code&gt;&amp;lt;h1&amp;gt;hello&amp;lt;/h1&amp;gt;&lt;/code&gt;ï¼Œè€Œ &lt;code&gt;&amp;lt;%- code %&amp;gt;&lt;/code&gt; åˆ™ä¼šæ˜¾ç¤º H1 å¤§çš„ hello å­—ç¬¦ä¸²ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬å¯ä»¥åœ¨ &lt;code&gt;&amp;lt;% %&amp;gt;&lt;/code&gt; å†…ä½¿ç”¨ JavaScript ä»£ç &lt;/p&gt;
&lt;pre class="highlight javascript"&gt;&lt;code&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nx"&gt;ul&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
 &lt;span class="o"&gt;&amp;lt;%&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nx"&gt;supplies&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;length&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;&lt;/span&gt;
    &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nx"&gt;li&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;lt;%=&lt;/span&gt; &lt;span class="nx"&gt;supplies&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;%&amp;gt;&amp;lt;&lt;/span&gt;&lt;span class="sr"&gt;/li&lt;/span&gt;&lt;span class="err"&gt;&amp;gt;
&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;%&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="o"&gt;%&amp;gt;&lt;/span&gt;
 &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="sr"&gt;/ul&lt;/span&gt;&lt;span class="err"&gt;&amp;gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;</content>
  </entry>
  <entry>
    <title>é˜¿é‡Œäº‘ Ubuntu æ”¯æŒ IPv6 çš„å®Œæ•´æ­¥éª¤</title>
    <link rel="alternate" href="https://jiandanxinli.github.io/2016-08-06.html"/>
    <id>https://jiandanxinli.github.io/2016-08-06.html</id>
    <published>2016-08-06T08:00:00+08:00</published>
    <updated>2016-08-07T17:57:49+08:00</updated>
    <author>
      <name>Ben</name>
    </author>
    <content type="html">&lt;p&gt;å‰å‡ å¤©æäº¤æ–°ç‰ˆ iOS App è¢«æ‹’ï¼ŒåŸå› æ˜¯åœ¨ IPv6 only çš„ç¯å¢ƒä¸‹æ— æ³•ä½¿ç”¨ã€‚ä½†é˜¿é‡Œäº‘çš„ ECS å¹¶ä¸æ”¯æŒ IPv6ï¼Œåªæä¾› IPv4 çš„ IPã€‚å¥½åœ¨ Hurricane Electric ï¼ˆä¸‹æ–‡ç®€ç§° HEï¼‰æä¾›å…è´¹çš„ IPv6 é€šé“ï¼ŒåŸºæœ¬å¤Ÿç”¨äº†ã€‚&lt;/p&gt;

&lt;p&gt;å…ˆè¯´ä¸‹ ECS çš„åŸºæœ¬ç¯å¢ƒï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;æ“ä½œç³»ç»Ÿï¼šUbuntu&lt;/li&gt;
&lt;li&gt;å‰ç«¯æœåŠ¡å™¨ï¼šNginx&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å¯ç”¨ IPv6 çš„ä¸»è¦æœ‰å››æ­¥ï¼š&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;æ³¨å†Œå¹¶åˆ›å»º IPv6 é€šé“&lt;/li&gt;
&lt;li&gt;é…ç½® ECS ä½¿å…¶æ”¯æŒ IPv6&lt;/li&gt;
&lt;li&gt;é…ç½® Nginx ä½¿å…¶ç›‘å¬ IPv6 ç«¯å£&lt;/li&gt;
&lt;li&gt;é…ç½® DNS ä½¿å…¶æ”¯æŒ IPv6 è§£æ&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;ç¬¬ä¸€æ­¥ï¼šæ³¨å†Œå¹¶åˆ›å»º IPv6 é€šé“&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;æ³¨å†Œ &lt;a href="https://www.tunnelbroker.net/"&gt;https://www.tunnelbroker.net/&lt;/a&gt; ï¼ˆéœ€è¦é‚®ç®±éªŒè¯ï¼‰&lt;/li&gt;
&lt;li&gt;ç‚¹å‡» &lt;a href="https://www.tunnelbroker.net/new_tunnel.php"&gt;Create Regular Tunnel&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;åœ¨&lt;code&gt;IPv4 Endpoint (Your side)&lt;/code&gt;å¤„å¡«ä¸Š ECS çš„ IPv4 åœ°å€&lt;/li&gt;
&lt;li&gt;åœ¨&lt;code&gt;Available Tunnel Servers&lt;/code&gt;ä¸­é€‰æ‹©&lt;code&gt;Hong Kong, HK&lt;/code&gt;ï¼ˆå¦‚æœä½ é¢å‘æµ·å¤–ç”¨æˆ·ï¼Œå¯ä»¥é€‰æ‹©æ›´æ¥è¿‘ç›®æ ‡ç”¨æˆ·çš„åœ°åŒºï¼‰&lt;/li&gt;
&lt;li&gt;ç‚¹å‡»&lt;code&gt;Create Tunnel&lt;/code&gt;åï¼Œé€šé“å°±åˆ›å»ºå®Œæˆäº†&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;ç¬¬äºŒæ­¥ï¼šé…ç½® ECS ä½¿å…¶æ”¯æŒ IPv6&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;ç¼–è¾‘&lt;code&gt;/etc/sysctl.conf&lt;/code&gt;ï¼Œå°†ä»¥ä¸‹ä¸‰é¡¹çš„é…ç½®æ”¹æˆ&lt;code&gt;0&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;pre class="highlight conf"&gt;&lt;code&gt;  &lt;span class="n"&gt;net&lt;/span&gt;.&lt;span class="n"&gt;ipv6&lt;/span&gt;.&lt;span class="n"&gt;conf&lt;/span&gt;.&lt;span class="n"&gt;all&lt;/span&gt;.&lt;span class="n"&gt;disable_ipv6&lt;/span&gt; = &lt;span class="m"&gt;0&lt;/span&gt;
  &lt;span class="n"&gt;net&lt;/span&gt;.&lt;span class="n"&gt;ipv6&lt;/span&gt;.&lt;span class="n"&gt;conf&lt;/span&gt;.&lt;span class="n"&gt;default&lt;/span&gt;.&lt;span class="n"&gt;disable_ipv6&lt;/span&gt; = &lt;span class="m"&gt;0&lt;/span&gt;
  &lt;span class="n"&gt;net&lt;/span&gt;.&lt;span class="n"&gt;ipv6&lt;/span&gt;.&lt;span class="n"&gt;conf&lt;/span&gt;.&lt;span class="n"&gt;lo&lt;/span&gt;.&lt;span class="n"&gt;disable_ipv6&lt;/span&gt; = &lt;span class="m"&gt;0&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨&lt;code&gt;/etc/network/interface&lt;/code&gt;åº•éƒ¨åŠ ä¸Šä»¥ä¸‹å†…å®¹ï¼ˆæ³¨ï¼šä¸‹é¢å¤§å†™çš„&lt;IPV6&gt;å¤„ï¼Œéœ€è¦æ›¿æ¢æˆä½ åœ¨ HE å¾—åˆ°çš„&lt;code&gt;Server IPv6 Address&lt;/code&gt;ï¼Œä½†ä¸åŒ…æ‹¬æœ€åçš„&lt;code&gt;::1/64&lt;/code&gt;ï¼Œå¦‚ï¼š&lt;code&gt;2001:470:100:100&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;pre class="highlight conf"&gt;&lt;code&gt;  &lt;span class="n"&gt;auto&lt;/span&gt; &lt;span class="n"&gt;he&lt;/span&gt;-&lt;span class="n"&gt;ipv6&lt;/span&gt;
  &lt;span class="n"&gt;iface&lt;/span&gt; &lt;span class="n"&gt;he&lt;/span&gt;-&lt;span class="n"&gt;ipv6&lt;/span&gt; &lt;span class="n"&gt;inet6&lt;/span&gt; &lt;span class="n"&gt;v4tunnel&lt;/span&gt;
  &lt;span class="n"&gt;address&lt;/span&gt; &amp;lt;&lt;span class="n"&gt;IPV6&lt;/span&gt;&amp;gt;::&lt;span class="m"&gt;2&lt;/span&gt;
  &lt;span class="n"&gt;netmask&lt;/span&gt; &lt;span class="m"&gt;64&lt;/span&gt;
  &lt;span class="n"&gt;remote&lt;/span&gt; &amp;lt;&lt;span class="n"&gt;HE&lt;/span&gt; çš„ &lt;span class="n"&gt;Server&lt;/span&gt; &lt;span class="n"&gt;IPv4&lt;/span&gt; &lt;span class="n"&gt;Address&lt;/span&gt;&amp;gt;
  &lt;span class="n"&gt;local&lt;/span&gt; &amp;lt;é˜¿é‡Œäº‘çš„ &lt;span class="n"&gt;IPv4&lt;/span&gt; åœ°å€&amp;gt;
  &lt;span class="n"&gt;endpoint&lt;/span&gt; &lt;span class="n"&gt;any&lt;/span&gt;
  &lt;span class="n"&gt;ttl&lt;/span&gt; &lt;span class="m"&gt;255&lt;/span&gt;
  &lt;span class="n"&gt;gateway&lt;/span&gt; &amp;lt;&lt;span class="n"&gt;IPv6&lt;/span&gt;&amp;gt;::&lt;span class="m"&gt;1&lt;/span&gt;
  &lt;span class="n"&gt;up&lt;/span&gt; &lt;span class="n"&gt;ip&lt;/span&gt; -&lt;span class="m"&gt;6&lt;/span&gt; &lt;span class="n"&gt;route&lt;/span&gt; &lt;span class="n"&gt;add&lt;/span&gt; &lt;span class="m"&gt;2000&lt;/span&gt;::/&lt;span class="m"&gt;3&lt;/span&gt; &lt;span class="n"&gt;via&lt;/span&gt; ::&amp;lt;&lt;span class="n"&gt;HE&lt;/span&gt; çš„ &lt;span class="n"&gt;Server&lt;/span&gt; &lt;span class="n"&gt;IPv4&lt;/span&gt; &lt;span class="n"&gt;Address&lt;/span&gt;&amp;gt; &lt;span class="n"&gt;dev&lt;/span&gt; &lt;span class="n"&gt;he&lt;/span&gt;-&lt;span class="n"&gt;ipv6&lt;/span&gt;
  &lt;span class="n"&gt;up&lt;/span&gt; &lt;span class="n"&gt;ip&lt;/span&gt; -&lt;span class="m"&gt;6&lt;/span&gt; &lt;span class="n"&gt;addr&lt;/span&gt; &lt;span class="n"&gt;add&lt;/span&gt; &amp;lt;&lt;span class="n"&gt;IPv6&lt;/span&gt;&amp;gt;::&lt;span class="m"&gt;1&lt;/span&gt;:&lt;span class="m"&gt;1&lt;/span&gt;/&lt;span class="m"&gt;128&lt;/span&gt; &lt;span class="n"&gt;dev&lt;/span&gt; &lt;span class="n"&gt;he&lt;/span&gt;-&lt;span class="n"&gt;ipv6&lt;/span&gt;
  &lt;span class="n"&gt;up&lt;/span&gt; &lt;span class="n"&gt;ip&lt;/span&gt; -&lt;span class="m"&gt;6&lt;/span&gt; &lt;span class="n"&gt;addr&lt;/span&gt; &lt;span class="n"&gt;add&lt;/span&gt; &amp;lt;&lt;span class="n"&gt;IPv6&lt;/span&gt;&amp;gt;::&lt;span class="m"&gt;2&lt;/span&gt;:&lt;span class="m"&gt;1&lt;/span&gt;/&lt;span class="m"&gt;128&lt;/span&gt; &lt;span class="n"&gt;dev&lt;/span&gt; &lt;span class="n"&gt;he&lt;/span&gt;-&lt;span class="n"&gt;ipv6&lt;/span&gt;
  &lt;span class="n"&gt;down&lt;/span&gt; &lt;span class="n"&gt;ip&lt;/span&gt; -&lt;span class="m"&gt;6&lt;/span&gt; &lt;span class="n"&gt;route&lt;/span&gt; &lt;span class="n"&gt;flush&lt;/span&gt; &lt;span class="n"&gt;dev&lt;/span&gt; &lt;span class="n"&gt;he&lt;/span&gt;-&lt;span class="n"&gt;ipv6&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;ol&gt;
&lt;li&gt;é‡å¯æœåŠ¡å™¨&lt;/li&gt;
&lt;li&gt;æ‰§è¡Œ&lt;code&gt;ifup he-ipv6&lt;/code&gt;ç¡®è®¤ IPv6 å·²å¯ç”¨&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;ç¬¬ä¸‰æ­¥ï¼šé…ç½® Nginx ä½¿å…¶ç›‘å¬ IPv6 ç«¯å£&lt;/p&gt;
&lt;pre class="highlight conf"&gt;&lt;code&gt;&lt;span class="n"&gt;server&lt;/span&gt; {
  &lt;span class="n"&gt;listen&lt;/span&gt; &lt;span class="m"&gt;80&lt;/span&gt;; // ç›‘å¬ &lt;span class="n"&gt;IPv4&lt;/span&gt; çš„ &lt;span class="m"&gt;80&lt;/span&gt; ç«¯å£
  &lt;span class="n"&gt;listen&lt;/span&gt; [::]:&lt;span class="m"&gt;80&lt;/span&gt;; // ç›‘å¬ &lt;span class="n"&gt;IPv6&lt;/span&gt; çš„ &lt;span class="m"&gt;80&lt;/span&gt; ç«¯å£
}

&lt;span class="n"&gt;server&lt;/span&gt; {
  &lt;span class="n"&gt;listen&lt;/span&gt; &lt;span class="m"&gt;443&lt;/span&gt; &lt;span class="n"&gt;ssl&lt;/span&gt; &lt;span class="n"&gt;http2&lt;/span&gt;; // ç›‘å¬ &lt;span class="n"&gt;IPv4&lt;/span&gt; çš„ &lt;span class="m"&gt;443&lt;/span&gt; ç«¯å£
  &lt;span class="n"&gt;listen&lt;/span&gt; [::]:&lt;span class="m"&gt;443&lt;/span&gt; &lt;span class="n"&gt;ssl&lt;/span&gt; &lt;span class="n"&gt;http2&lt;/span&gt;; // ç›‘å¬ &lt;span class="n"&gt;IPv6&lt;/span&gt; çš„ &lt;span class="m"&gt;443&lt;/span&gt; ç«¯å£
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç¬¬å››æ­¥ï¼šé…ç½® DNS ä½¿å…¶æ”¯æŒ IPv6 è§£æ&lt;/p&gt;

&lt;p&gt;è¿™æ­¥æœ€ç®€å•ï¼Œåªéœ€ç»™ç›¸åº”çš„åŸŸååŠ ä¸Š&lt;code&gt;AAAA&lt;/code&gt;è§£æï¼Œå€¼å¡« HE é‡Œçš„&lt;code&gt;Client IPv6 Address&lt;/code&gt;ï¼Œå»æ‰æœ€åçš„&lt;code&gt;/64&lt;/code&gt;å³å¯ï¼Œå¦‚&lt;code&gt;2001:470:100:100::2&lt;/code&gt;&lt;/p&gt;
</content>
  </entry>
  <entry>
    <title>Rails ActiveRecord ä¸åŒçš„èµ‹å€¼æ–¹æ³•</title>
    <link rel="alternate" href="https://jiandanxinli.github.io/2016-07-31.html"/>
    <id>https://jiandanxinli.github.io/2016-07-31.html</id>
    <published>2016-07-31T08:00:00+08:00</published>
    <updated>2016-08-04T13:13:28+08:00</updated>
    <author>
      <name>fengd</name>
    </author>
    <content type="html">&lt;p&gt;Rails æä¾›äº†å¤šç§è®¾ç½®Modelå±æ€§çš„æ–¹æ³•ï¼Œæ–¹æ³•ä¹‹é—´åˆå„æœ‰å¼‚åŒï¼Œæœ‰çš„ä¼šå‡ºå‘å›è°ƒï¼Œæœ‰çš„ä¸ä¼šï¼Œæœ‰çš„ä¼šå¯¹æ‰€å±å¯¹è±¡å…¶å®ƒå±æ€§ä¹Ÿäº§ç”Ÿå½±å“ã€‚ å› æ­¤ç†è§£æ–¹æ³•ä¹‹é—´çš„åŒºåˆ«å°±æ˜¾å¾—å¾ˆé‡è¦ã€‚&lt;/p&gt;

&lt;h3&gt;Cheat Sheet&lt;/h3&gt;

&lt;p&gt;æœ€æ–¹ä¾¿çš„å…ˆæ¥ï¼Œcheetsheetè¡¨ï¼Œæ–¹ä¾¿æŸ¥è¯¢ï¼š&lt;/p&gt;

&lt;table class="table-compact table table-striped"&gt;
                &lt;thead&gt;
                  &lt;tr&gt;
                    &lt;th&gt;Method&lt;/th&gt;
                    &lt;th&gt;Uses Default Accessor&lt;/th&gt;
                    &lt;th&gt;Saved to Database&lt;/th&gt;
                    &lt;th&gt;Validations&lt;/th&gt;
                    &lt;th&gt;Callbacks&lt;/th&gt;
                    &lt;th&gt;Touches &lt;code&gt;updated_at&lt;/code&gt;&lt;/th&gt;
                    &lt;th&gt;Readonly check&lt;/th&gt;
                  &lt;/tr&gt;
                &lt;/thead&gt;
                &lt;tbody&gt;
                  &lt;tr&gt;
                    &lt;td&gt;&lt;a href="http://apidock.com/rails/ActiveRecord/AttributeMethods/Write/attribute%3D" style="text-decoration: none"&gt;attribute=&lt;/a&gt;&lt;/td&gt;
                    &lt;td&gt;Yes&lt;/td&gt;
                    &lt;td&gt;No&lt;/td&gt;
                    &lt;td&gt;&lt;span style="color: #c0c0c0;"&gt;n/a&lt;/span&gt;&lt;/td&gt;
                    &lt;td&gt;&lt;span style="color: #c0c0c0;"&gt;n/a&lt;/span&gt;&lt;/td&gt;
                    &lt;td&gt;&lt;span style="color: #c0c0c0;"&gt;n/a&lt;/span&gt;&lt;/td&gt;
                    &lt;td&gt;&lt;span style="color: #c0c0c0;"&gt;n/a&lt;/span&gt;&lt;/td&gt;
                  &lt;/tr&gt;
                  &lt;tr&gt;
                    &lt;td&gt;&lt;a href="http://apidock.com/rails/ActiveRecord/AttributeMethods/Write/write_attribute" style="text-decoration: none"&gt;write_attribute&lt;/a&gt;&lt;/td&gt;
                    &lt;td&gt;No&lt;/td&gt;
                    &lt;td&gt;No&lt;/td&gt;
                    &lt;td&gt;&lt;span style="color: #c0c0c0;"&gt;n/a&lt;/span&gt;&lt;/td&gt;
                    &lt;td&gt;&lt;span style="color: #c0c0c0;"&gt;n/a&lt;/span&gt;&lt;/td&gt;
                    &lt;td&gt;&lt;span style="color: #c0c0c0;"&gt;n/a&lt;/span&gt;&lt;/td&gt;
                    &lt;td&gt;&lt;span style="color: #c0c0c0;"&gt;n/a&lt;/span&gt;&lt;/td&gt;
                  &lt;/tr&gt;
                  &lt;tr&gt;
                    &lt;td&gt;&lt;a href="http://apidock.com/rails/ActiveRecord/Persistence/update_attribute" style="text-decoration: none"&gt;update_attribute&lt;/a&gt;&lt;/td&gt;
                    &lt;td&gt;Yes&lt;/td&gt;
                    &lt;td&gt;Yes&lt;/td&gt;
                    &lt;td&gt;No&lt;/td&gt;
                    &lt;td&gt;Yes&lt;/td&gt;
                    &lt;td&gt;Yes&lt;/td&gt;
                    &lt;td&gt;Yes&lt;/td&gt;
                  &lt;/tr&gt;
                  &lt;tr&gt;
                    &lt;td&gt;&lt;a href="http://apidock.com/rails/ActiveRecord/AttributeAssignment/attributes%3D" style="text-decoration: none"&gt;attributes=&lt;/a&gt;&lt;/td&gt;
                    &lt;td&gt;Yes&lt;/td&gt;
                    &lt;td&gt;No&lt;/td&gt;
                    &lt;td&gt;&lt;span style="color: #c0c0c0;"&gt;n/a&lt;/span&gt;&lt;/td&gt;
                    &lt;td&gt;&lt;span style="color: #c0c0c0;"&gt;n/a&lt;/span&gt;&lt;/td&gt;
                    &lt;td&gt;&lt;span style="color: #c0c0c0;"&gt;n/a&lt;/span&gt;&lt;/td&gt;
                    &lt;td&gt;&lt;span style="color: #c0c0c0;"&gt;n/a&lt;/span&gt;&lt;/td&gt;
                  &lt;/tr&gt;
                  &lt;tr&gt;
                    &lt;td&gt;&lt;a href="http://apidock.com/rails/ActiveRecord/Persistence/update" style="text-decoration: none"&gt;update&lt;/a&gt;&lt;/td&gt;
                    &lt;td&gt;Yes&lt;/td&gt;
                    &lt;td&gt;Yes&lt;/td&gt;
                    &lt;td&gt;Yes&lt;/td&gt;
                    &lt;td&gt;Yes&lt;/td&gt;
                    &lt;td&gt;Yes&lt;/td&gt;
                    &lt;td&gt;Yes&lt;/td&gt;
                  &lt;/tr&gt;
                  &lt;tr&gt;
                    &lt;td&gt;&lt;a href="http://apidock.com/rails/ActiveRecord/Persistence/update_column" style="text-decoration: none"&gt;update_column&lt;/a&gt;&lt;/td&gt;
                    &lt;td&gt;No&lt;/td&gt;
                    &lt;td&gt;Yes&lt;/td&gt;
                    &lt;td&gt;No&lt;/td&gt;
                    &lt;td&gt;No&lt;/td&gt;
                    &lt;td&gt;No&lt;/td&gt;
                    &lt;td&gt;Yes&lt;/td&gt;
                  &lt;/tr&gt;
                  &lt;tr&gt;
                    &lt;td&gt;&lt;a href="http://apidock.com/rails/ActiveRecord/Persistence/update_columns" style="text-decoration: none"&gt;update_columns&lt;/a&gt;&lt;/td&gt;
                    &lt;td&gt;No&lt;/td&gt;
                    &lt;td&gt;Yes&lt;/td&gt;
                    &lt;td&gt;No&lt;/td&gt;
                    &lt;td&gt;No&lt;/td&gt;
                    &lt;td&gt;No&lt;/td&gt;
                    &lt;td&gt;Yes&lt;/td&gt;
                  &lt;/tr&gt;
                  &lt;tr&gt;
                    &lt;td&gt;&lt;a href="http://apidock.com/rails/ActiveRecord/Relation/update" style="text-decoration: none"&gt;User::update&lt;/a&gt;&lt;/td&gt;
                    &lt;td&gt;Yes&lt;/td&gt;
                    &lt;td&gt;Yes&lt;/td&gt;
                    &lt;td&gt;Yes&lt;/td&gt;
                    &lt;td&gt;Yes&lt;/td&gt;
                    &lt;td&gt;Yes&lt;/td&gt;
                    &lt;td&gt;Yes&lt;/td&gt;
                  &lt;/tr&gt;
                  &lt;tr&gt;
                    &lt;td&gt;&lt;a href="http://apidock.com/rails/v4.0.2/ActiveRecord/Relation/update_all" style="text-decoration: none"&gt;User::update_all&lt;/a&gt;&lt;/td&gt;
                    &lt;td&gt;No&lt;/td&gt;
                    &lt;td&gt;Yes&lt;/td&gt;
                    &lt;td&gt;No&lt;/td&gt;
                    &lt;td&gt;No&lt;/td&gt;
                    &lt;td&gt;No&lt;/td&gt;
                    &lt;td&gt;No&lt;/td&gt;
                  &lt;/tr&gt;
                &lt;/tbody&gt;
              &lt;/table&gt;

&lt;h3&gt;user.name =&lt;/h3&gt;

&lt;p&gt;è¿™æ˜¯æœ€å¸¸ç”¨çš„èµ‹å€¼æ–¹æ³•ï¼Œè¿™ä¸ªä¹Ÿæ˜¯Railsé»˜è®¤ç”Ÿæˆçš„èµ‹å€¼æ–¹æ³•ã€‚èµ‹å€¼åï¼Œå¯¹åº”çš„å±æ€§ä¼šè¢«æ ‡è®°ä¸ºdirty, è„æ•°æ®ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æ›´æ–°åˆ°æ•°æ®é‡Œå»ã€‚&lt;/p&gt;

&lt;p&gt;è°ƒç”¨&lt;code&gt;save&lt;/code&gt;ä¼šæŠŠæ•°æ®æ›´æ–°åˆ°æ•°æ®åº“ã€‚è°ƒç”¨&lt;code&gt;reload&lt;/code&gt;ä¼šä¸¢å¼ƒè„æ•°æ®ã€‚&lt;/p&gt;

&lt;h3&gt;user.write_attribute(:name, &amp;#39;feng&amp;#39;)&lt;/h3&gt;

&lt;p&gt;è¿™æ˜¯ä¸Šé¢é‚£ä¸ªèµ‹å€¼æ–¹æ³•ä¼šè°ƒç”¨çš„æ–¹æ³•ï¼Œ è¿™ä¸ªæ–¹æ³•ä¹Ÿä¸ä¼šæ›´æ–°æ•°æ®åº“ã€‚&lt;/p&gt;

&lt;h3&gt;user.update_attribute(:name, &amp;#39;feng&amp;#39;)&lt;/h3&gt;

&lt;p&gt;è¿™ä¸ªæ–¹æ³•ä¼šç›´æ¥æ›´æ–°æ•°æ®åˆ°æ•°æ®åº“ï¼Œè€Œä¸”ä¼šå¿½ç•¥åˆ°æ‰€æœ‰çš„éªŒè¯ï¼Œç›´æ¥æ›´æ–°æ•°æ®åº“ã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;æ‰€æœ‰æ›´æ–°ä¼šç›´æ¥åˆ°æ•°æ®åº“&lt;/li&gt;
&lt;li&gt;æ‰€æœ‰çš„éªŒè¯ä¼šè¢«è·³è¿‡&lt;/li&gt;
&lt;/ul&gt;

&lt;h3&gt;user.attributes = { name: &amp;#39;feng&amp;#39; }&lt;/h3&gt;

&lt;p&gt;è¿™ä¸ªèµ‹å€¼æ–¹æ³•ä¼šæ ¹æ®å³è¾¹ä¼ å…¥çš„å“ˆå¸Œï¼Œå¯¹ç›¸åº”çš„å±æ€§è¿›è¡Œèµ‹å€¼ã€‚å…¶å®ƒçš„å±æ€§ä¸ä¼šæœ‰å˜åŠ¨ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;user.assign_attributes { name: &amp;#39;feng&amp;#39; }&lt;/code&gt;&lt;/p&gt;

&lt;h3&gt;user.update(name: &amp;#39;feng&amp;#39;)&lt;/h3&gt;

&lt;p&gt;åœ¨Rails 3ä¸­ï¼Œè¿™ä¸ªæ–¹æ³•å«&lt;code&gt;update_attributes&lt;/code&gt;ï¼Œ è¿™ä¸ªæ–¹æ³•ä¼šæ›´æ–°å¯¹è±¡ï¼Œè¿›è¡ŒéªŒè¯ï¼Œç„¶åæ›´æ–°åˆ°æ•°æ®åº“.è¿™æ–¹æ³•ä¼šæŠŠæ‰€å±å¯¹è±¡ä¸­åˆ«çš„è„æ•°æ®ä¹Ÿæ›´æ–°åˆ°æ•°æ®åº“ã€‚&lt;/p&gt;

&lt;h3&gt;user.update_columns(name: &amp;#39;feng&amp;#39;)&lt;/h3&gt;

&lt;p&gt;è¿™ä¸ªæ–¹æ³•ä¼šç”Ÿæˆ SQL Updateï¼Œç›´æ¥æ›´æ–°åˆ°æ•°æ®åº“ï¼Œè·³è¿‡æ‰€æœ‰çš„æ•°æ®éªŒè¯å’Œå›è°ƒã€‚&lt;/p&gt;

&lt;h3&gt;user.update_column(:name, &amp;#39;feng&amp;#39;)&lt;/h3&gt;

&lt;p&gt;è·Ÿä¸Šé¢çš„æ–¹æ³•ç±»ä¼¼&lt;/p&gt;

&lt;h3&gt;User.update(1, name: &amp;#39;feng&amp;#39;)&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;è¿™æ˜¯ä¸€ä¸ªç±»æ–¹æ³•&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;è¿™ä¸ªæ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ &lt;code&gt;id&lt;/code&gt;, åé¢æ˜¯æ›´æ–°çš„å±æ€§hashã€‚ ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œ ä¸€ç»„ &lt;code&gt;id&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;h3&gt;User.update_all(name: &amp;#39;feng&amp;#39;)&lt;/h3&gt;

&lt;p&gt;æ‰¹é‡æ›´æ–°ï¼Œ&lt;strong&gt;be carefulï¼&lt;/strong&gt;&lt;/p&gt;
</content>
  </entry>
  <entry>
    <title>é€‰æ‹© jsonapi-resources çš„ç†ç”±</title>
    <link rel="alternate" href="https://jiandanxinli.github.io/2016-07-30.html"/>
    <id>https://jiandanxinli.github.io/2016-07-30.html</id>
    <published>2016-07-30T08:00:00+08:00</published>
    <updated>2016-08-04T13:09:46+08:00</updated>
    <author>
      <name>Ben</name>
    </author>
    <content type="html">&lt;p&gt;Rails 5 å‘å¸ƒæ—¶çš„å®˜æ–¹æ—¥å¿—é‡Œï¼Œæ¨èäº†ä¸‰ç§ç”¨äºæ„å»º API çš„ gemï¼Œåˆ†åˆ«æ˜¯ &lt;a href="https://github.com/rails/jbuilder"&gt;Jbuilder&lt;/a&gt;ã€&lt;a href="https://github.com/rails-api/active_model_serializers"&gt;Active Model Serializers&lt;/a&gt; å’Œ &lt;a href="https://github.com/cerebris/jsonapi-resources"&gt;JSONAPI::Resources&lt;/a&gt;ï¼Œå…¶ä¸­å‰ä¸¤ç§éœ€è¦é…åˆ rails-api æ¥ä½¿ç”¨ï¼Œåªæœ‰ jsonapi-resources æä¾›äº† JSONAPI::ResourceControllerã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬æœ€ç»ˆé€‰æ‹©äº† jsonapi-resources ä¸»è¦åŸºäºä»¥ä¸‹åŸå› ï¼š&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;å®ƒçš„ resource è¯­æ³•ä¸ active_model_serializers ç›¸è¿‘ï¼Œè€Œæˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çš„æ˜¯ active_model_serializers&lt;/li&gt;
&lt;li&gt;active_model_serializers ä¸æ”¯æŒ abstract ç‰¹æ€§ï¼Œå¿…é¡»åŸºäºæŸä¸ª modelï¼Œè€Œæˆ‘ä»¬æœ‰äº› resource å¹¶éåŸºäº model&lt;/li&gt;
&lt;li&gt;jsonapi-resources å†…ç½®äº† fields é€‰é¡¹ï¼Œå¯ä»¥æ–¹ä¾¿çš„åœ¨è¯·æ±‚ç«¯æŒ‡å®šè¿”å›çš„å­—æ®µï¼Œè€Œä¸å¿…è¿”å›å…¨éƒ¨å­—æ®µ&lt;/li&gt;
&lt;li&gt;è¿”å›çš„æ•°æ®ç»“æ„ç¬¦åˆ &lt;a href="http://jsonapi.org/"&gt;jsonapi è§„èŒƒ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;JSONAPI::ResourceController æä¾›äº† RESTful çš„å°è£…ï¼Œå¯ä»¥çœå»ä¸å°‘ä»£ç &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;ä»¥ä¸Šçš„åŸå› åªæ˜¯å¯¹ç›®å‰é¡¹ç›®æ¥è¯´æœ€éœ€è¦çš„ç‰¹æ€§ï¼Œæ›´å¤šç‰¹æ€§å¯ä»¥å»çœ‹å®˜æ–¹æ–‡æ¡£ã€‚&lt;/p&gt;

&lt;p&gt;å‚è€ƒé“¾æ¥ï¼š&lt;/p&gt;

&lt;p&gt;jsonapi-resourcesï¼š &lt;a href="https://github.com/cerebris/jsonapi-resources"&gt;https://github.com/cerebris/jsonapi-resources&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;jsonapiï¼š&lt;a href="http://jsonapi.org"&gt;http://jsonapi.org&lt;/a&gt;&lt;/p&gt;
</content>
  </entry>
  <entry>
    <title>iOSä¸Šç®€æ˜“è½®æ’­å›¾çš„å®ç°</title>
    <link rel="alternate" href="https://jiandanxinli.github.io/2016-07-29.html"/>
    <id>https://jiandanxinli.github.io/2016-07-29.html</id>
    <published>2016-07-29T08:00:00+08:00</published>
    <updated>2016-07-31T09:15:08+08:00</updated>
    <author>
      <name>Qiuncheng</name>
    </author>
    <content type="html">&lt;h3&gt;å‰è¨€&lt;/h3&gt;

&lt;p&gt;è§è¿‡å¾ˆå¤šçš„iOSåº”ç”¨ï¼Œéƒ½æœ‰æ— é™è½®æ’­å›¾ï¼Œä¹‹å‰ä¹Ÿçœ‹åˆ°è¿‡å¾ˆå¤šç›¸å…³å®ç°çš„æ–‡ç« ï¼Œå¯æ˜¯ä»…ä»…å°±æ˜¯ä¸€çœ‹è€Œè¿‡ç½¢äº†ã€‚å½“è‡ªå·±åœ¨é¡¹ç›®ä¸­ç”¨åˆ°è¿™ä¸ªï¼ŒçœŸæ­£å»å†™çš„æ—¶å€™æ‰å‘ç°ä¸æ˜¯å¾ˆå®¹æ˜“ï¼Œé‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œè¿™ç¯‡æ–‡ç« å°±è®°å½•ä¸‹è‡ªå·±æœ€åæˆåŠŸå®ç°è½®æ’­å›¾çš„å†ç¨‹ã€‚&lt;/p&gt;

&lt;h3&gt;åŸç†&lt;/h3&gt;

&lt;p&gt;åŸç†å…¶å®å°±æ˜¯ä¸€ç§å‡è±¡ã€‚ä¸è¿‡åœ¨æˆ‘è¿™é‡Œï¼Œç›®å‰æœ‰è¿‡ä¸¤ç§åŸç†çš„å®ç°ã€‚ä¸€ç§åˆ©ç”¨&lt;code&gt;UICollectionView&lt;/code&gt;å®ç°è½®æ’­ï¼Œå¦ä¸€ç§åˆ©ç”¨&lt;code&gt;UIScrollView&lt;/code&gt;å®ç°è½®æ’­ã€‚
ä»Šå¤©æˆ‘ä»¬è¦æ¥æ‰“é€ ä¸€æ¬¾è¿™æ ·çš„è½®æ’­å›¾ï¼ˆå›¾ç”»çš„ä¸å¥½ï¼Œè¯·å‹¿è§æ€ªï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src="https://cloud.githubusercontent.com/assets/9990834/17270175/36fa47a0-568f-11e6-8f3f-bbed783d6b41.png" alt="ä¸¾ä¾‹ï¼šä¸‰å¼ å›¾çš„æ— é™è½®æ’­" /&gt;&lt;/p&gt;

&lt;h4&gt;åŸç†ä¸€ï¼šåˆ©ç”¨&lt;code&gt;UIScrollView&lt;/code&gt;å®ç°è½®æ’­å›¾ã€‚&lt;/h4&gt;

&lt;p&gt;è¦æƒ³å®ç°è¿™æ ·çš„æ•ˆæœï¼Œæˆ‘ä»¬ä½¿ç”¨&lt;code&gt;UIScrollView&lt;/code&gt;åŒ…å«image0ï¼Œimage1ï¼Œimage2çš„ä¸‰ä¸ª&lt;code&gt;UIImageView&lt;/code&gt;éƒ½æ˜¯æ”¾åœ¨&lt;code&gt;UIScrollView&lt;/code&gt;é‡Œé¢çš„ï¼Œä½†æ˜¯è¿™æ ·çš„è¯æ˜¯ä¸å¯ä»¥å®ç°è½®æ’­çš„ã€‚è¦æƒ³å®ç°è½®æ’­å°±è¦å†åœ¨è¯¥&lt;code&gt;UIScrollView&lt;/code&gt;çš„å·¦å³ä¸¤ä¾§å„åŠ ä¸€å¼ &lt;code&gt;UIImageView&lt;/code&gt;ã€‚åœ¨æœ€åä¸€å¼ æ”¾image0ï¼Œ ç¬¬ä¸€å¼ æ”¾image2ã€‚è¿™æ ·çš„è¯å½“æˆ‘ä»¬æ»šåŠ¨åˆ°æœ€åæˆ–è€…æœ€å‰é¢çš„çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±æŠŠåˆ—è¡¨åˆ‡æ¢åˆ°ç›¸åº”çš„ä½ç½®ï¼Œæ³¨æ„è¿™æ—¶å€™åˆ‡æ¢çš„æ—¶å€™ä¸èƒ½æœ‰åŠ¨ç”»ã€‚åªéœ€è¦è°ƒç”¨&lt;code&gt;scrollView.contentOffset = CGPoint(...)&lt;/code&gt;å³å¯ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src="https://cloud.githubusercontent.com/assets/9990834/17270176/408925d4-568f-11e6-9217-e26c3cf09093.png" alt="å®é™…UISrollViewå›¾" /&gt;&lt;/p&gt;

&lt;h4&gt;åŸç†äºŒï¼šåˆ©ç”¨&lt;code&gt;UICollectionView&lt;/code&gt;å®ç°è½®æ’­å›¾ã€‚&lt;/h4&gt;

&lt;p&gt;ä½ å½“ç„¶å¯ä»¥åˆ©ç”¨&lt;strong&gt;åŸç†ä¸€&lt;/strong&gt;å†ç”¨&lt;code&gt;UICollectionView&lt;/code&gt;å®ç°ä¸€æ¬¡ã€‚ä½†æ˜¯æˆ‘è¿™é‡Œé‡‡ç”¨ä¸€ç§å·æ‡’çš„æ–¹å¼ï¼Œåˆ©ç”¨&lt;code&gt;UICollectionView&lt;/code&gt;çš„cellé‡ç”¨æœºåˆ¶ã€‚åˆ›å»ºä¸ªæ— æ•°ä¸ªcellï¼Œæ¯”å¦‚3x20000ã€‚å½“ç”¨æˆ·ç¬¬ä¸€æ¬¡è¿›æ¥çš„æˆ‘ä»¬å°±å°†UICollectionViewæ»‘åˆ°3x20000x0.5çš„ä½ç½®ã€‚ç„¶ååˆ©ç”¨&lt;code&gt;cell.indexPath.item % 3&lt;/code&gt;æ¥å¯¹cellä¸Šçš„UIImageViewè¿›è¡Œimageæ˜¾ç¤ºã€‚è¿™ç§æ–¹å¼æ¯”è¾ƒå·æ‡’ï¼Œåœ¨åæ¥æ·»åŠ NSTimerè‡ªåŠ¨è½®æ’­å’Œç‚¹å‡»äº‹ä»¶çš„æ—¶å€™ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œä¸è¿‡æœ‰ç‚¹å¤§ç‚®æ‰“å°é¸Ÿçš„æ„Ÿè§‰ã€‚æ‰€ä»¥æˆ‘åœ¨è¿™é‡Œä¹Ÿåªæ˜¯ä»‹ç»ä¸‹åŸç†ï¼Œå¦‚æœä½ æœ‰å…´è¶£ï¼Œå¯ä»¥è‡ªå·±å°è¯•å»å®ç°ä¸‹ã€‚è€Œä¸”UICollectionViewè‡ªå¸¦ä¸€ä¸ªæ–¹æ³•&lt;code&gt;- scrollToItemAtIndexPath:atScrollPosition:animated:&lt;/code&gt;è¿˜æ¯”è¾ƒå‰å®³ã€‚&lt;/p&gt;

&lt;h3&gt;å…·ä½“å®ç°&lt;/h3&gt;

&lt;p&gt;é’ˆå¯¹åŸç†ä¸€ï¼Œæˆ‘å°±æ¥ç®€å•å®ç°ä¸‹ã€‚(æˆ‘è¿™é‡Œä½¿ç”¨ä»£ç åˆ›å»º,ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨Storyboardåˆ›å»º,åŸç†ä¸€æ ·)&lt;/p&gt;

&lt;h4&gt;åˆ›å»ºå·¥ç¨‹ï¼Œåˆ›å»º&lt;code&gt;BannerView.Swift&lt;/code&gt;,æ·»åŠ åˆå§‹åŒ–ä»£ç å¦‚ä¸‹ï¼š&lt;/h4&gt;
&lt;pre class="highlight plaintext"&gt;&lt;code&gt;/// åˆå§‹åŒ–scrollView
lazy var scrollView: UIScrollView = {
       let scrollView = UIScrollView()
       scrollView.delegate = self
       scrollView.alwaysBounceVertical = false
       scrollView.bounces = true
       scrollView.pagingEnabled = true
       scrollView.scrollEnabled = true
       scrollView.showsVerticalScrollIndicator = false
       scrollView.showsHorizontalScrollIndicator = false
       return scrollView
   }()
/// åˆå§‹åŒ–pageControl
   lazy var pageControl: UIPageControl = {
       let pageControl = UIPageControl()
       pageControl.currentPageIndicatorTintColor = UIColor.redColor()
       pageControl.pageIndicatorTintColor = UIColor.whiteColor()
       return pageControl
   }()

   /// åœ¨inité‡Œè°ƒç”¨setupSubviewså³å¯
   func setupSubviews() {  
       self.addSubview(scrollView)
       self.addSubview(pageControl)

       scrollView.translatesAutoresizingMaskIntoConstraints = false
       pageControl.translatesAutoresizingMaskIntoConstraints = false

       self.addConstraints(NSLayoutConstraint.constraintsWithVisualFormat("V:|[v]|", options: [], metrics: nil, views: ["v": scrollView]))
       self.addConstraints(NSLayoutConstraint.constraintsWithVisualFormat("H:|[v]|", options: [], metrics: nil, views: ["v": scrollView]))

       self.addConstraints(NSLayoutConstraint.constraintsWithVisualFormat("V:[p(==20)]-10-|", options: [], metrics: nil, views: ["p": pageControl]))
       self.addConstraints(NSLayoutConstraint.constraintsWithVisualFormat("H:[p(==100)]-10-|", options: [], metrics: nil, views: ["p": pageControl]))
   }
&lt;/code&gt;&lt;/pre&gt;
&lt;h4&gt;åˆå§‹åŒ–UIScrollViewï¼š&lt;/h4&gt;
&lt;pre class="highlight plaintext"&gt;&lt;code&gt;func setupScrollView() {
        /// åˆ›å»º ï¼ˆimageNames.count + 2ï¼‰ä¸ªUIImageView
        for index in 0 ... (imageNmaes.count + 1) {
            let imageView = UIImageView(frame: CGRect(x: self.width*CGFloat(index), y: 0, width: self.width, height: self.height))
            var picName = String()
            switch index {
            case 0:
                picName = imageNames[imageNames.count-1]
                break
            case imageNames.count + 1:
                picName = imageNames[0]
                break
            default:
                picName = imageNames[index-1]
                break
            }

//          imageView.af_setImageWithURL(NSURL(string: picName)!)
            imageView.image = UIImage(named: picName)
            imageView.contentMode = .ScaleToFill
            imageView.clipsToBounds = true
            imageView.userInteractionEnabled = true
            scrollView.addSubview(imageView)
        }
        scrollView.contentSize = CGSize(width: self.width * CGFloat(imageNames.count + 2), height: self.height)
        scrollView.contentOffset = CGPoint(x: self.width, y: 0)
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;h4&gt;æ— é™è½®ç•ªçš„å®ç°ã€‚ï¼ˆé‡ç‚¹ï¼‰ä½¿ç”¨UIScrollViewDelegateåè®®ã€‚&lt;/h4&gt;
&lt;pre class="highlight plaintext"&gt;&lt;code&gt;func scrollViewDidScroll(scrollView: UIScrollView) {
       if scrollView == self.scrollView {
           let contentOffsetX = scrollView.contentOffset.x
          ///å‘å‰æ»‘åŠ¨åˆ°ç¬¬0å¼ å›¾çš„æ—¶å€™ï¼Œæ»šåˆ°ç¬¬ä¸‰å¼ å›¾
           if contentOffsetX == 0 {
               scrollView.contentOffset = CGPoint(x: self.width * CGFloat(self.imageNames.count), y: 0)
           }
           /// è·‘åˆ°ç¬¬ä¸‰å¼ å›¾çš„æ—¶å€™ï¼Œæ»šåˆ°ç¬¬0å¼ å›¾
           if contentOffsetX == CGFloat(self.imageNames.count + 1)*self.width {
               scrollView.contentOffset = CGPoint(x: self.width, y: 0)
           }
           /// æ”¹å˜pageControlï¼Œè¿™é‡Œè¦æ³¨æ„ï¼Œä¸€å®šè¦ä¸€å®šè¦ä¸€å®šè¦ - 0.5ï¼Œ å› ä¸ºæœ€å‰é¢çš„ç¬¬0å¼ å›¾ä¸€ç›´ä¸æ˜¾ç¤ºã€‚
           let index = scrollView.contentOffset.x / self.width - 0.5
           self.pageControl.currentPage = Int(index)
       }
   }
&lt;/code&gt;&lt;/pre&gt;
&lt;h4&gt;æ·»åŠ è®¡æ—¶å™¨&lt;/h4&gt;

&lt;p&gt;å¥½äº†ï¼Œåšåˆ°è¿™é‡Œï¼Œä½ å·²ç»æˆåŠŸå®ç°äº†è½®æ’­å›¾ï¼Œå¯æ˜¯è¿™ä¸ªè½®æ’­å›¾æ˜¯æ‰‹åŠ¨çš„ï¼Œä¸‹é¢æ·»åŠ è‡ªåŠ¨æ»šåŠ¨ã€‚ä¹Ÿå¾ˆç®€å•ï¼Œè®¾ç½®ä¸€ä¸ªNSTimerè®¡æ—¶å™¨å³å¯ã€‚ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre class="highlight plaintext"&gt;&lt;code&gt;// MARK: - Timer
   var timer: NSTimer?
   var i = 1
   /// åœ¨scrollViewä¸Šçš„å›¾ç‰‡æˆåŠŸè®¾ç½®åè°ƒç”¨startTimerå³å¯
   private func startTimer() {
       if timer != nil {
           self.stopTimer()
       }
       /// è¿™é‡Œè®¾ç½®çš„æ»šåŠ¨é—´éš”ä¸º2ç§’
       timer = NSTimer.scheduledTimerWithTimeInterval(2, target: self, selector: #selector(autoScroll), userInfo: nil, repeats: true)
       NSRunLoop.currentRunLoop().addTimer(timer!, forMode: NSDefaultRunLoopMode)
   }
   private func stopTimer() {
       timer?.invalidate()
       timer = nil
   }
   func autoScroll() {
       if i == imageNames.count + 1 {
           i = 1
       }
       i += 1
       /// åœ¨å¤„ç†æ— é™è½®ç•ªçš„æ—¶å€™è®¾ç½®contentOffsetæ²¡æœ‰æ·»åŠ animatedï¼Œè¿™é‡Œè¦æ·»åŠ ä¸Šæ¥ï¼Œä¸ç„¶æœ‰ç§å¾ˆçªå…€çš„æ„Ÿè§‰ã€‚
       scrollView.setContentOffset(CGPoint(x: self.width * CGFloat(i), y: 0), animated: true)
   }
    /// æ‰‹åŠ¨æ»šåŠ¨ç»“æŸåæ¢å¤è®¡æ—¶
   func scrollViewDidEndDragging(scrollView: UIScrollView, willDecelerate decelerate: Bool) {
        self.startTimer()
    }
    /// å½“æ‰‹åŠ¨æ»šåŠ¨å¼€å§‹æ—¶åœæ­¢è®¡æ—¶
    func scrollViewWillBeginDragging(scrollView: UIScrollView) {
        self.stopTimer()
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;h4&gt;æ·»åŠ å…·ä½“ç‚¹å‡»äº‹ä»¶&lt;/h4&gt;

&lt;p&gt;å…·ä½“åˆ°ç‚¹å‡»äº‹ä»¶çš„è¯ï¼Œæˆ‘æ˜¯æ”¾åœ¨åˆå§‹åŒ–imageViewé‚£é‡Œå¤„ç†çš„ï¼Œç»™imageVIewæ·»åŠ ä¸€ä¸ªUITapGestureRecognizerï¼Œåœ¨è¿™é‡Œæœ€å¥½å†å†™ä¸€ä¸ªä»£ç†æ–¹æ³•ï¼Œå°†imageViewçš„ç‚¹å‡»äº‹ä»¶ä¼ é€’å‡ºå»ã€‚ç„¶åæ ¹æ®å½“å‰&lt;code&gt;contentOffet.x / self.width&lt;/code&gt;æ¥å°†å…·ä½“å“ªå¼ å›¾ç‰‡çš„äº‹ä»¶ä¼ é€’å‡ºå»ã€‚æˆ‘å°±ä¸ç”¨ä»£ç å±•ç¤ºäº†ã€‚&lt;/p&gt;

&lt;h3&gt;ç»“å°¾&lt;/h3&gt;

&lt;p&gt;è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ã€‚ä½†æ˜¯æˆ‘è¿™ä¸ªå¤ç”¨æ€§æ¯”è¾ƒå·®ï¼Œå°è£…çš„ä¹Ÿä¸å¥½ï¼Œå¯æ˜¯å…·ä½“è¦çœ‹æ€è·¯ğŸ˜‚ã€‚ä»£ç å®ç°æ”¾åœ¨äº†Github Wikiä¸Šäº†&lt;a href="https://github.com/qiuncheng/qiuncheng.github.io/wiki/BannerView.Swift"&gt;BannerView.Swift&lt;/a&gt;ï¼Œç”±äºå·¥ç¨‹é‡å¤ªå°ï¼Œå°±æ²¡å°†å·¥ç¨‹æ–‡ä»¶ä¸Šä¼ äº†ã€‚&lt;/p&gt;

&lt;h4&gt;å…³äºä½œè€…&lt;/h4&gt;

&lt;p&gt;&lt;a href="http://qiuncheng.com"&gt;Qiuncheng&lt;/a&gt;ï¼Œä¸€ä½æ­£åœ¨iOSè·¯ä¸Šå‰è¡Œçš„åˆå­¦è€…ï¼Œæ­£åœ¨åŠªåŠ›æˆä¸ºä¸€ååˆæ ¼çš„iOSå¼€å‘è€…ã€‚&lt;/p&gt;
</content>
  </entry>
  <entry>
    <title>2.5 ä¸ªäººå¦‚ä½•å¼€å‘ä¸€æ¬¾è·¨ç»ˆç«¯çš„äº§å“ï¼Ÿ[Ruby Tuesday çš„åˆ†äº«]</title>
    <link rel="alternate" href="https://jiandanxinli.github.io/2015-09-08.html"/>
    <id>https://jiandanxinli.github.io/2015-09-08.html</id>
    <published>2015-09-08T08:00:00+08:00</published>
    <updated>2016-07-27T11:40:16+08:00</updated>
    <author>
      <name>Ben</name>
    </author>
    <content type="html">&lt;h2&gt;2.5 ä¸ªäººï¼Ÿ&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;1 ä¸ªå…¨æ ˆï¼ˆæˆ‘ ^_^ï¼‰&lt;/li&gt;
&lt;li&gt;1 ä¸ª Ruby ç¨‹åºå‘˜&lt;/li&gt;
&lt;li&gt;0.5 ä¸ªå‰ç«¯å¼€å‘ï¼ˆäº§å“ç»ç†å…¼èŒï¼‰&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;è·¨ç»ˆç«¯ï¼Ÿ&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;ç”µè„‘ï¼šæµè§ˆå™¨ã€å¾®ä¿¡ PC ç‰ˆï¼ˆPC ç‰ˆå¾®ä¿¡æ”¯æŒå¾®ä¿¡ç™»é™†ï¼‰&lt;/li&gt;
&lt;li&gt;å¹³æ¿ï¼šæµè§ˆå™¨ã€Appï¼ˆAndroid &amp;amp; iOSï¼‰ã€å¾®ä¿¡&lt;/li&gt;
&lt;li&gt;æ‰‹æœºï¼šæµè§ˆå™¨ã€Appï¼ˆAndroid &amp;amp; iOSï¼‰ã€å¾®ä¿¡&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è¿™äº›ç»ˆç«¯ä¸ä»…ç”¨äºè®¿é—®ï¼Œè¿˜éœ€è¦æ”¯æŒæ¨é€å’Œæ”¯ä»˜ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;é€šçŸ¥æ¸ é“ï¼šé‚®ä»¶ã€çŸ­ä¿¡ã€å¾®ä¿¡ã€App æ¨é€&lt;/li&gt;
&lt;li&gt;æ”¯ä»˜æ¸ é“ï¼šæ”¯ä»˜å®ã€å¾®ä¿¡æ”¯ä»˜ã€é“¶è”æ”¯ä»˜&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;è§£å†³æ–¹æ¡ˆ&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;å°½å¯èƒ½é™ä½å¼€å‘å·¥ä½œé‡ï¼ˆäººå‘˜æœ‰é™ï¼‰&lt;/li&gt;
&lt;li&gt;å°½å¯èƒ½åˆ©ç”¨ RoR å·²æœ‰æŠ€æœ¯&lt;/li&gt;
&lt;li&gt;åŸºäº User Agent ä¿¡æ¯æ¥åŒºåˆ†å…·ä½“ç»ˆç«¯&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;ä» RoR å‡ºå‘&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ Turbolinks ä¼˜åŒ–ç½‘é¡µåŠ è½½ä½“éªŒ&lt;/li&gt;
&lt;li&gt;ä¸ä½¿ç”¨å‰ç«¯ MVC æ¡†æ¶åŠ é‡å·¥ä½œé‡&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨å“åº”å¼è®¾è®¡ + éƒ¨åˆ†é¡µé¢ Variant Response&lt;/li&gt;
&lt;li&gt;ä¸é’ˆå¯¹å„ä¸ªç»ˆç«¯å•ç‹¬åˆ¶ä½œé¡µé¢&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;åŸºäº browser åŒºåˆ†ç»ˆç«¯&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;browser çš„åŒé‡å«ä¹‰ï¼šæµè§ˆå™¨ å’Œ browser gem&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªç»ˆç«¯éƒ½æœ‰å„è‡ªçš„ User Agent&lt;/li&gt;
&lt;li&gt;é€šè¿‡æ‰©å±• browser gem æ¥åˆ¤æ–­å½“å‰çš„ç»ˆç«¯ç±»å‹&lt;/li&gt;
&lt;li&gt;é€šè¿‡æ‰“å°ç»ˆç«¯ç±»å‹åˆ° body class ä½¿å¾— CSS å¯ä»¥é’ˆå¯¹æ€§è°ƒæ•´æ ·å¼&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;å…·ä½“æ­¥éª¤&lt;/h2&gt;

&lt;h3&gt;1. ä½¿ç”¨å¹¶æ‰©å±• &lt;a href="https://github.com/fnando/browser"&gt;browser gem&lt;/a&gt; æ¥åˆ¤æ–­ç»ˆç«¯ç±»å‹&lt;/h3&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="no"&gt;Browser&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;NAMES&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:smileback&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;'SmileBack'&lt;/span&gt; &lt;span class="c1"&gt;# æˆ‘ä»¬ App çš„è‡ªå®šä¹‰ User Agent æ ‡è¯†&lt;/span&gt;
&lt;span class="no"&gt;Browser&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;NAMES&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:wechat&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;'Wechat'&lt;/span&gt;
&lt;span class="no"&gt;Browser&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;NAMES&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:desktop&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;'Desktop'&lt;/span&gt;

&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Browser&lt;/span&gt;
  &lt;span class="k"&gt;module&lt;/span&gt; &lt;span class="nn"&gt;Meta&lt;/span&gt;
    &lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Smileback&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;Base&lt;/span&gt;
      &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;meta&lt;/span&gt;
        &lt;span class="s1"&gt;'smileback'&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;browser&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;smileback?&lt;/span&gt;
      &lt;span class="k"&gt;end&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;

    &lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Wechat&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;Base&lt;/span&gt;
      &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;meta&lt;/span&gt;
        &lt;span class="s1"&gt;'wechat'&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;browser&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;wechat?&lt;/span&gt;
      &lt;span class="k"&gt;end&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;

    &lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Desktop&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;Base&lt;/span&gt;
      &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;meta&lt;/span&gt;
        &lt;span class="s1"&gt;'desktop'&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;browser&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;desktop?&lt;/span&gt;
      &lt;span class="k"&gt;end&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;module&lt;/span&gt; &lt;span class="nn"&gt;Consoles&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;smileback?&lt;/span&gt;
      &lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ua&lt;/span&gt; &lt;span class="o"&gt;=~&lt;/span&gt; &lt;span class="sr"&gt;/smileback/i&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nf"&gt;nil?&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;wechat?&lt;/span&gt;
      &lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ua&lt;/span&gt; &lt;span class="o"&gt;=~&lt;/span&gt; &lt;span class="sr"&gt;/MicroMessenger/i&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nf"&gt;nil?&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;desktop?&lt;/span&gt;
      &lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="n"&gt;mobile?&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="n"&gt;wechat?&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="n"&gt;smileback?&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;2. åœ¨ html body class é‡Œæ·»åŠ  browser ä¿¡æ¯ï¼Œæ–¹ä¾¿ CSS å¥—ç”¨&lt;/h3&gt;
&lt;pre class="highlight erb"&gt;&lt;code&gt;&lt;span class="nt"&gt;&amp;lt;body&lt;/span&gt; &lt;span class="na"&gt;class=&lt;/span&gt;&lt;span class="s"&gt;"&lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;%=&lt;/span&gt; &lt;span class="no"&gt;Browser&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;new&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;ua: &lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;env&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;'HTTP_USER_AGENT'&lt;/span&gt;&lt;span class="p"&gt;]).&lt;/span&gt;&lt;span class="nf"&gt;to_s&lt;/span&gt; &lt;span class="cp"&gt;%&amp;gt;&lt;/span&gt;&lt;span class="s"&gt;"&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt; &lt;span class="c"&gt;&amp;lt;!-- class ä¼šè¾“å‡ºå¦‚ chrome modern mac webkit desktop æˆ– iphone ios mobile modern other safari safari5 webkit --!&amp;gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre class="highlight css"&gt;&lt;code&gt;&lt;span class="nt"&gt;body&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="c"&gt;/* é»˜è®¤çš„æ ·å¼ */&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="nt"&gt;body&lt;/span&gt;&lt;span class="nc"&gt;.desktop&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="c"&gt;/* æ¡Œé¢æµè§ˆå™¨å®šåˆ¶æ ·å¼ */&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="nt"&gt;body&lt;/span&gt;&lt;span class="nc"&gt;.mobile&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="c"&gt;/* æ‰‹æœºæµè§ˆå™¨å®šåˆ¶æ ·å¼ */&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="nt"&gt;body&lt;/span&gt;&lt;span class="nc"&gt;.wechat&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="c"&gt;/* å¾®ä¿¡å®šåˆ¶æ ·å¼ */&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;3. ä½¿ç”¨ &lt;a href="http://api.rubyonrails.org/classes/ActionController/MimeResponds.html"&gt;Variant Response&lt;/a&gt; æ¥é’ˆå¯¹éƒ¨åˆ†åŒºåˆ«å¤§çš„é¡µé¢åšä¸¤å¥—æˆ–å¤šå¥— views&lt;/h3&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="c1"&gt;# application_controller.rb&lt;/span&gt;

&lt;span class="n"&gt;before_action&lt;/span&gt; &lt;span class="ss"&gt;:detect_browser&lt;/span&gt;

&lt;span class="kp"&gt;private&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;detect_browser&lt;/span&gt;
  &lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;variant&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="ss"&gt;:mobile&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="no"&gt;Browser&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;new&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;ua: &lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;env&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;'HTTP_USER_AGENT'&lt;/span&gt;&lt;span class="p"&gt;]).&lt;/span&gt;&lt;span class="nf"&gt;mobile?&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;éœ€è¦æ‹†åˆ†çš„é¡µé¢ï¼Œåšæˆå¦‚ä¸‹å½¢å¼ï¼š&lt;/p&gt;
&lt;pre class="highlight plaintext"&gt;&lt;code&gt;app/views/pages/home.erb
app/views/pages/home.html+mobile.erb # æ–‡ä»¶åæ ¼å¼ä¸º å“åº”æ ¼å¼+è®¾å¤‡å
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;4. æ·»åŠ  helperï¼Œæ–¹ä¾¿å¤æ‚çš„æƒ…å†µä¸‹è°ƒç”¨ï¼Œæ¯”å¦‚æ”¯ä»˜&lt;/h3&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="c1"&gt;# application_helper.rb&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;browser&lt;/span&gt;
  &lt;span class="vi"&gt;@_browser&lt;/span&gt; &lt;span class="o"&gt;||=&lt;/span&gt; &lt;span class="no"&gt;Browser&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;new&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;ua: &lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;env&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;'HTTP_USER_AGENT'&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;pre class="highlight slim"&gt;&lt;code&gt;&lt;span class="c"&gt;/ æ‡’å¾—è½¬ erb æ ¼å¼äº†ï¼Œä¸‹é¢è¿™æ®µæ˜¯ slim æ ¼å¼çš„&lt;/span&gt;
&lt;span class="p"&gt;-&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;browser&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;smileback?&lt;/span&gt;
  &lt;span class="nt"&gt;a&lt;/span&gt;&lt;span class="nc"&gt;.button&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="na"&gt;href&lt;/span&gt;&lt;span class="p"&gt;=&lt;/span&gt;&lt;span class="s"&gt;"jdxlsmileback://recharges/#{resource.id}/pay"&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;æ”¯ä»˜å®ä»˜æ¬¾
  &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;link_to&lt;/span&gt; &lt;span class="s1"&gt;'é“¶è”ä»˜æ¬¾'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;pay_recharge_path&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;resource&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;unionpay: &lt;/span&gt;&lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="s1"&gt;'data-no-turbolink'&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;
&lt;span class="p"&gt;-&lt;/span&gt; &lt;span class="k"&gt;elsif&lt;/span&gt; &lt;span class="n"&gt;browser&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;wechat?&lt;/span&gt;
  &lt;span class="p"&gt;-&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;current_user&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;weixin_id&lt;/span&gt;
    &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;link_to&lt;/span&gt; &lt;span class="s1"&gt;'å¾®ä¿¡æ”¯ä»˜'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'#'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;id: &lt;/span&gt;&lt;span class="s1"&gt;'wepay'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;class: &lt;/span&gt;&lt;span class="s1"&gt;'button'&lt;/span&gt;
    &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;link_to&lt;/span&gt; &lt;span class="s1"&gt;'é“¶è”ä»˜æ¬¾'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;pay_recharge_path&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;resource&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;unionpay: &lt;/span&gt;&lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="s1"&gt;'data-no-turbolink'&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;
  &lt;span class="p"&gt;-&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt;
    &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;link_to&lt;/span&gt; &lt;span class="s1"&gt;'é“¶è”ä»˜æ¬¾'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;pay_recharge_path&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;resource&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;unionpay: &lt;/span&gt;&lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="s1"&gt;'data-no-turbolink'&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;class: &lt;/span&gt;&lt;span class="s1"&gt;'button'&lt;/span&gt;
&lt;span class="p"&gt;-&lt;/span&gt; &lt;span class="k"&gt;elsif&lt;/span&gt; &lt;span class="n"&gt;browser&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;mobile?&lt;/span&gt;
  &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;link_to&lt;/span&gt; &lt;span class="s1"&gt;'æ”¯ä»˜å®ä»˜æ¬¾'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;pay_recharge_path&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;resource&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;alipay: &lt;/span&gt;&lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="ss"&gt;class: &lt;/span&gt;&lt;span class="s1"&gt;'button'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'data-no-turbolink'&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;
  &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;link_to&lt;/span&gt; &lt;span class="s1"&gt;'é“¶è”ä»˜æ¬¾'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;pay_recharge_path&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;resource&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;unionpay: &lt;/span&gt;&lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="s1"&gt;'data-no-turbolink'&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;
&lt;span class="p"&gt;-&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt;
  &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;link_to&lt;/span&gt; &lt;span class="s1"&gt;'æ”¯ä»˜å®ä»˜æ¬¾'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;pay_recharge_path&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;resource&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;alipay: &lt;/span&gt;&lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="ss"&gt;class: &lt;/span&gt;&lt;span class="s1"&gt;'button'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'data-no-turbolink'&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;
  &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;link_to&lt;/span&gt; &lt;span class="s1"&gt;'å¾®ä¿¡æ”¯ä»˜'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;pay_recharge_path&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;resource&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;scan_wepay: &lt;/span&gt;&lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="n"&gt;link_to&lt;/span&gt; &lt;span class="s1"&gt;'é“¶è”ä»˜æ¬¾'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;pay_recharge_path&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;resource&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;unionpay: &lt;/span&gt;&lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="s1"&gt;'data-no-turbolink'&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;å…¶å®ƒç»éªŒ&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;iOS App æˆ‘ä»¬ç”¨ WKWebView å¥—çš„å£³ï¼ŒWKWebView æ¯” UIWebView æ€§èƒ½æ›´å¥½äº›ï¼Œä½†é™åˆ¶ä¹Ÿæ›´å¤šäº›ï¼Œå…·ä½“å¯ä»¥ Googleã€‚&lt;/li&gt;
&lt;li&gt;Android App æˆ‘ä»¬ç”¨é»˜è®¤çš„ WebViewï¼Œç›®å‰æ²¡å‘ç°æ›´å¥½çš„æ›¿ä»£å“ã€‚&lt;/li&gt;
&lt;li&gt;æ”¯ä»˜æ¸ é“ä¹‹å‰æˆ‘ä»¬æ˜¯è‡ªå·±å°è£…çš„ï¼Œç°åœ¨å‘ç° &lt;a href="https://pingxx.com"&gt;Ping++&lt;/a&gt; ä¹Ÿä¸é”™ï¼Œå¤§å®¶å¯ä»¥è¯•è¯•ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;é‡ç‚¹æ¥äº†ï¼ï¼ï¼&lt;/h2&gt;

&lt;h3&gt;ç®€å•å¿ƒç†æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;æœ€å¤§çš„åè¯­å¿ƒç†å’¨è¯¢å¹³å°&lt;/li&gt;
&lt;li&gt;æœ€ä¸¥æ ¼çš„å’¨è¯¢å¸ˆå…¥é©»å®¡æ ¸&lt;/li&gt;
&lt;li&gt;ç«‹å¿—äºæä¾›æœ€ä¸“ä¸šçš„å¿ƒç†æœåŠ¡&lt;/li&gt;
&lt;/ul&gt;

&lt;h3&gt;å†…å¿ƒä¸–ç•Œé‚£ä¹ˆå¤§ï¼Œæƒ³ä¸æƒ³æ¥çœ‹çœ‹ï¼Ÿ&lt;/h3&gt;

&lt;p&gt;æˆ‘ä»¬éœ€è¦ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Ruby å·¥ç¨‹å¸ˆ æœˆè–ª 15k èµ·&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æˆ‘ä»¬æä¾›ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;æœ€äººæ€§åŒ–çš„å·¥ä½œç¯å¢ƒï¼ˆè€æ¿åŠå¤§éƒ¨åˆ†å‘˜å·¥éƒ½æœ‰å¿ƒç†å­¦ä¸“ä¸šèƒŒæ™¯ï¼Œç¨‹åºå‘˜é¼“åŠ±å¸ˆå¼±çˆ†äº† :smirk: ï¼‰&lt;/li&gt;
&lt;li&gt;éåŒ—äº¬åœ°åŒºå¯è¿œç¨‹å·¥ä½œï¼ˆæœ¬éƒ¨ä½äºåŒ—äº¬ä¸­å…³æ‘ï¼‰&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ¬¢è¿å‹¾æ­ &lt;a href="mailto:hr@jiandanxinli.com"&gt;hr@jiandanxinli.com&lt;/a&gt;&lt;/p&gt;

&lt;h2&gt;ä¼‘æ¯ä¸‹ï¼Œçœ‹çœ‹å…»çœ¼çš„ç…§ç‰‡å§ï¼ˆé PSï¼‰&lt;/h2&gt;

&lt;p&gt;å¥³ç‹å¤§äººï¼ˆæ›¾ç”¨åï¼šç…¤çƒï¼‰åŠå¥¹çš„å­©å­ä»¬
&lt;img src="http://jdxl-img.b0.upaiyun.com/id_cards/f6c6fb9742d94eb1aa5f73eb3e8b15d1.jpg" alt="çŒ«" /&gt;&lt;/p&gt;

&lt;p&gt;å„ç§å¸…å“¥ç¾å¥³äº‘é›†çš„æ´»åŠ¨
&lt;img src="http://jdxl-img.b0.upaiyun.com/id_cards/6a9656184f9a467eac8d7c7f5ab0d5e2.jpg" alt="å¸…å“¥ç¾å¥³" /&gt;&lt;/p&gt;

&lt;p&gt;äº†è§£æ›´å¤šæˆ‘ä»¬å…¬å¸çš„è¯¦æƒ…å¯ä»¥ç§»æ­¥è¿™é‡Œï¼š &lt;a href="https://www.jiandanxinli.com/pages/37"&gt;https://www.jiandanxinli.com/pages/37&lt;/a&gt;&lt;/p&gt;
</content>
  </entry>
  <entry>
    <title>Railsé—ç•™ç¨‹åºé‡Œæœ€å¸¸çŠ¯çš„é”™è¯¯(è¯‘)</title>
    <link rel="alternate" href="https://jiandanxinli.github.io/2014-07-23.html"/>
    <id>https://jiandanxinli.github.io/2014-07-23.html</id>
    <published>2014-07-23T08:00:00+08:00</published>
    <updated>2016-08-08T10:12:51+08:00</updated>
    <author>
      <name>éŸ©å†°</name>
    </author>
    <content type="html">&lt;p&gt;åŸæ–‡å‡ºè‡ª&lt;a href="http://edelpero.svbtle.com/most-common-mistakes-on-legacy-rails-apps"&gt;most-common-mistakes-on-legacy-rails-apps&lt;/a&gt;, æ„Ÿè°¢ä½œè€…&lt;a href="http://edelpero.svbtle.com/"&gt;EZEQUIEL DELPERO&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;è¿‘æ¥æˆ‘ä¸€ç›´åœ¨å¯¹å‡ ä¸ªé—ç•™é¡¹ç›®ä½œç»´æŠ¤ã€‚&lt;/p&gt;

&lt;p&gt;ä¼—æ‰€å‘¨çŸ¥ï¼Œå¤„ç†é—ç•™é¡¹ç›®å¤šæ•°æ—¶é—´éƒ½æ„Ÿè§‰ç³Ÿé€äº†ï¼Œå› ä¸ºé‚£äº›ä»£ç é€šå¸¸éƒ½ä¸‘é™‹ä¸å ªè€Œä¸”æ™¦æ¶©éš¾æ‡‚ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘å†³å®šåšä¸€ä¸ªåˆ—è¡¨ï¼Œè®°å½•ä¸‹é‚£äº›å…¬è®¤çš„ä¸è‰¯å®è·µï¼Œæˆ–è€…æ˜¯æˆ‘è®¤ä¸ºä¸å¤ªå¥½çš„å®è·µï¼Œä»¥åŠå¦‚ä½•æ”¹è‰¯ä»£ç æ¥é¿å…è¿™äº›ä¸è‰¯å®è·µã€‚&lt;/p&gt;

&lt;h3&gt;é—®é¢˜ä¸€è§ˆ&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;åœ¨æ¨¡å‹å±‚ä»¥å¤–ä½¿ç”¨æŸ¥è¯¢æ–¹æ³•&lt;/li&gt;
&lt;li&gt;åœ¨è§†å›¾å±‚ä½¿ç”¨ä¸šåŠ¡é€»è¾‘&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨æ— æ„ä¹‰çš„æ–¹æ³•åå’Œå˜é‡å&lt;/li&gt;
&lt;li&gt;æ¡ä»¶åˆ¤æ–­æ—¶ä½¿ç”¨unlessæˆ–è€…å¦å®šçš„è¡¨è¾¾å¼&lt;/li&gt;
&lt;li&gt;æ²¡æœ‰éµå¾ªâ€œå‘½ä»¤ï¼Œä¸è¦å»è¯¢é—®â€åŸåˆ™&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨å¤æ‚çš„æ¡ä»¶&lt;/li&gt;
&lt;li&gt;åœ¨æ¨¡å‹çš„å®ä¾‹æ–¹æ³•é‡Œï¼Œæœ¬æ¥ä¸éœ€è¦çš„æ—¶å€™ä½¿ç”¨äº†â€œself.â€&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨æ¡ä»¶è¡¨è¾¾å¼å¹¶ä¸”è¿”å›äº†æ¡ä»¶&lt;/li&gt;
&lt;li&gt;åœ¨è§†å›¾å±‚ä½¿ç”¨è¡Œå†…æ ·å¼&lt;/li&gt;
&lt;li&gt;åœ¨è§†å›¾å±‚ä½¿ç”¨JavaScript&lt;/li&gt;
&lt;li&gt;è°ƒç”¨æ–¹æ³•æ—¶æŠŠå¦ä¸€ä¸ªæ–¹æ³•çš„è°ƒç”¨ä½œä¸ºå‚æ•°&lt;/li&gt;
&lt;li&gt;æ²¡æœ‰ä½¿ç”¨ç±»æ¥éš”ç¦»Rake Tasks&lt;/li&gt;
&lt;li&gt;æ²¡æœ‰éµå¾ªSandi Metzçš„è§„åˆ™&lt;/li&gt;
&lt;/ul&gt;

&lt;h3&gt;åœ¨æ¨¡å‹å±‚ä»¥å¤–ä½¿ç”¨æŸ¥è¯¢æ–¹æ³•&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;ä¸å¥½çš„&lt;/strong&gt;&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="c1"&gt;# app/controllers/users_controller.rb&lt;/span&gt;
&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;UsersController&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ApplicationController&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;index&lt;/span&gt;
    &lt;span class="vi"&gt;@users&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;User&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;active: &lt;/span&gt;&lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nf"&gt;order&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:last_login_at&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™æ®µä»£ç ä¸å¯é‡ç”¨è€Œä¸”éš¾äºæµ‹è¯•ã€‚å¦‚æœä½ åœ¨åˆ«çš„åœ°æ–¹ä¹Ÿæƒ³æŸ¥æ‰¾å…¨éƒ¨ç”¨æˆ·å¹¶è¿›è¡Œæ’åºï¼Œå°±ä¼šå‡ºç°å†—ä½™ä»£ç ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å¥½çš„&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æ¯”èµ·åœ¨æ§åˆ¶å™¨é‡Œä½¿ç”¨æŸ¥è¯¢æ–¹æ³•ï¼Œæˆ‘ä»¬çš„åšæ³•æ˜¯åœ¨æ¨¡å‹å±‚ä¸­ä½¿ç”¨scopeæŠŠå®ƒä»¬ç‹¬ç«‹å‡ºæ¥ï¼Œå°±å¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚è¿™æ ·åšæ—¢å¯ä»¥ä½¿ä»£ç èƒ½å¤Ÿå¤ç”¨ï¼Œåˆä¾¿äºä»£ç é˜…è¯»å’Œæµ‹è¯•ã€‚&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="c1"&gt;# app/models/user.rb&lt;/span&gt;
&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;User&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;

  &lt;span class="n"&gt;scope&lt;/span&gt; &lt;span class="ss"&gt;:active&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="n"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;active: &lt;/span&gt;&lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="n"&gt;scope&lt;/span&gt; &lt;span class="ss"&gt;:by_last_login_at&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="n"&gt;order&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:lasst_login_at&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="c1"&gt;# app/controllers/users_controller.rb&lt;/span&gt;
&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;UsersController&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ApplicationController&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;index&lt;/span&gt;
    &lt;span class="vi"&gt;@users&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;User&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;active&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;by_last_login_at&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ¯å½“ä½ æƒ³ç”¨whereã€orderã€joinsã€includesã€groupã€havingæˆ–è€…å…¶ä»–æŸ¥è¯¢æ–¹æ³•æ—¶ï¼Œè®°å¾—è¦æŠŠå®ƒä»¬æ”¾åœ¨æ¨¡å‹å±‚é‡Œã€‚&lt;/p&gt;

&lt;h3&gt;åœ¨è§†å›¾å±‚ä½¿ç”¨ä¸šåŠ¡é€»è¾‘&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;ä¸å¥½çš„&lt;/strong&gt;&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="o"&gt;&amp;lt;!--&lt;/span&gt; &lt;span class="n"&gt;app&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;views&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;posts&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;show&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;html&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;erb&lt;/span&gt; &lt;span class="o"&gt;--&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;.&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;
&lt;span class="nf"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;h2&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="sx"&gt;%= "#{@comments.count} Comment#{@comments.count =&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="p"&gt;?&lt;/span&gt; &lt;span class="s1"&gt;''&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'s'&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;" %&amp;gt;
&amp;lt;/h2&amp;gt;
...
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åˆçœ‹ä¹‹ä¸‹è¿™å°æ®µä»£ç ä¼¼ä¹æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯å®ƒä¼šè®©HTMLå˜å¾—æœ‰ç‚¹éš¾ä»¥é˜…è¯»ï¼Œè€Œä¸”å¯ä»¥è‚¯å®šçš„è¯´ä¸€æ—¦ä½ åœ¨è§†å›¾å±‚æ·»åŠ äº†é€»è¾‘ä»£ç ï¼Œé‚£ä¹ˆæ—¥åä½ å®šä¼šæ·»åŠ æ›´å¤šçš„é€»è¾‘åˆ°è§†å›¾ã€‚è¿™æ®µä»£ç è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œé‡Œé¢çš„é€»è¾‘æ— æ³•å¤ç”¨ï¼Œè€Œä¸”ä¸èƒ½å•ç‹¬æµ‹è¯•ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å¥½çš„&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨Railsçš„helperæ–¹æ³•æŠŠä¸šåŠ¡é€»è¾‘éš”ç¦»å‡ºæ¥&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="c1"&gt;# app/helpers/comments_helper.rb&lt;/span&gt;
&lt;span class="k"&gt;module&lt;/span&gt; &lt;span class="nn"&gt;CommentsHelper&lt;/span&gt;
  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;comments_count&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;comments&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="s2"&gt;"&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;comments&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;count&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt; Comment&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;comments&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;count&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="p"&gt;?&lt;/span&gt; &lt;span class="s1"&gt;''&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'s'&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;"&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="o"&gt;&amp;lt;!--&lt;/span&gt; &lt;span class="n"&gt;app&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;views&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;posts&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;show&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;html&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;erb&lt;/span&gt; &lt;span class="o"&gt;--&amp;gt;&lt;/span&gt;
&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;h2&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="sx"&gt;%= comments_count(@comments) %&amp;gt;
&amp;lt;/h2&amp;gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;ä½¿ç”¨æ— æ„ä¹‰çš„æ–¹æ³•åå’Œå˜é‡å&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;ä¸å¥½çš„&lt;/strong&gt;&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="c1"&gt;# app/models/topic.rb&lt;/span&gt;
&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Topic&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nc"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;r_topics&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;questions&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;rt&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;

    &lt;span class="n"&gt;questions&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;each&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;q&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
      &lt;span class="n"&gt;topics&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;q&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;topics&lt;/span&gt;

      &lt;span class="n"&gt;topics&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;each&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;enabled?&lt;/span&gt;
          &lt;span class="n"&gt;rt&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;t&lt;/span&gt;
        &lt;span class="k"&gt;end&lt;/span&gt;
      &lt;span class="k"&gt;end&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;

    &lt;span class="no"&gt;Topic&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;id: &lt;/span&gt;&lt;span class="n"&gt;rt&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™ç±»é—ç•™ä»£ç æœ€ä¸»è¦çš„é—®é¢˜åœ¨äºï¼šä½ éœ€è¦èŠ±è´¹å¤§æŠŠæ—¶é—´æ¥ææ¸…æ¥šè¿™äº›ä»£ç çš„ç”¨é€”ã€‚r_topicsè¿™ä¸ªæ–¹æ³•æ˜¯åšä»€ä¹ˆçš„ï¼Œrtè¿™ä¸ªå˜é‡åˆæ˜¯ä»€ä¹ˆæ„æ€ã€‚å…¶ä»–çš„ä¸€äº›å˜é‡ï¼Œæ¯”å¦‚åœ¨ä»£ç å—é‡Œç”¨åˆ°çš„é‚£ä¸ªï¼Œå˜é‡åçš„å«ä¹‰å¾ˆæ¨¡ç³Šï¼Œè¿™æ ·ä¹Ÿä½¿å¾—å®ƒä»¬çš„ç”¨é€”åˆçœ‹èµ·æ¥å¾ˆéš¾ç†è§£ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å¥½çš„&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å¯¹æ–¹æ³•å’Œå˜é‡å‘½åæ—¶é€‰é‚£äº›èƒ½è¡¨è¾¾å‡ºå…¶å«ä¹‰çš„åå­—ã€‚è¿™æ ·æ›´ä¾¿äºå…¶ä»–å¼€å‘è€…ç†è§£ä½ çš„ä»£ç ã€‚&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="c1"&gt;# app/models/topic.rb&lt;/span&gt;
&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Topic&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nc"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;related&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;questions&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;related_topics&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;

    &lt;span class="n"&gt;questions&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;each&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
      &lt;span class="n"&gt;topics&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;topics&lt;/span&gt;

      &lt;span class="n"&gt;topics&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;each&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;topic&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;topic&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;enabled?&lt;/span&gt;
          &lt;span class="n"&gt;related_topics&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;topic&lt;/span&gt;
        &lt;span class="k"&gt;end&lt;/span&gt;
      &lt;span class="k"&gt;end&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;

    &lt;span class="no"&gt;Topic&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;id: &lt;/span&gt;&lt;span class="n"&gt;related_topics&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™æ ·æ”¹è¿›çš„å¥½å¤„åœ¨äºï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;ç¬¬ä¸€æ¬¡çœ‹åˆ°æ–¹æ³•åæ—¶å°±ä¼šå¯¹æ–¹æ³•è¿”å›å€¼æœ‰ä¸ªæ¦‚å¿µã€‚ä¸€ä¸ªä¸ç»™å®šé—®é¢˜é›†åˆç›¸å…³è”çš„ä¸»é¢˜çš„é›†åˆã€‚&lt;/li&gt;
&lt;li&gt;ç°åœ¨ä½ èƒ½å¤Ÿäº†è§£related_topicsè¡¨ç¤ºä¸€ä¸ªæ•°ç»„ï¼Œå®ƒé‡Œé¢å­˜æ”¾äº†ä¸€ä¸ªä¸ç»™å®šé—®é¢˜é›†åˆç›¸å…³è”çš„ä¸»é¢˜çš„é›†åˆã€‚ä¹‹å‰æ‰“ä»£ç é‡Œrtè¡¨ç¤ºä»€ä¹ˆéå¸¸å«ç³Šã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨topicä»£æ›¿ä¹‹å‰çš„tï¼Œå¹¶ç”¨questionæ›¿æ¢æ‰qï¼Œä½¿å¾—ä½ çš„ä»£ç æ›´ä¾¿äºé˜…è¯»ï¼Œå› ä¸ºä½ ä¸å†éœ€è¦è„‘è¡¥è¿™äº›å˜é‡çš„ç”¨é€”ã€‚ç°åœ¨è¿™äº›ä»£ç å·²ç„¶èƒ½å¤Ÿè‡ªè§£é‡Šä¸€åˆ‡ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h3&gt;æ¡ä»¶åˆ¤æ–­æ—¶ä½¿ç”¨unlessæˆ–è€…å¦å®šçš„è¡¨è¾¾å¼&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;ä¸å¥½çš„&lt;/strong&gt;&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="c1"&gt;# app/services/charge_user.rb&lt;/span&gt;
&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;ChargeUser&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nc"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;perform&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;amount&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="kp"&gt;false&lt;/span&gt; &lt;span class="k"&gt;unless&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;enabled?&lt;/span&gt;

    &lt;span class="no"&gt;PaymentGateway&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;charge&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;account_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;amount&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™æ®µä»£ç ä¹Ÿè®¸å¹¶ä¸éš¾ç†è§£ï¼Œä½†æ˜¯ä½¿ç”¨unlessæˆ–è€…å¦å®šçš„æ¡ä»¶è¡¨è¾¾å¼ä¼šç¨å¾®å¢åŠ ä»£ç çš„å‘å¤æ‚åº¦ï¼Œå› ä¸ºä½ å¿…é¡»å¯¹å®ƒè¦åˆ¤æ–­çš„æ¡ä»¶è‡ªè¡Œè„‘è¡¥ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å¥½çš„&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æ”¹ç”¨ifæˆ–è€…è‚¯å®šçš„æ¡ä»¶è¡¨è¾¾å¼ä¹‹åï¼Œä¸Šè¿°ä»£ç å°±ä¼šå¥½æ‡‚å¾—å¤šã€‚&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="c1"&gt;# app/models/user.rb&lt;/span&gt;
&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;User&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;disabled?&lt;/span&gt;
    &lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="n"&gt;enabled?&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="c1"&gt;# app/services/charge_user.rb&lt;/span&gt;
&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;ChargeUser&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nc"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;perform&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;amount&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="kp"&gt;false&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;disabled?&lt;/span&gt;

    &lt;span class="no"&gt;PaymentGateway&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;charge&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;account_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;amount&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä¸è§‰å¾—è¿™æ ·å†™ä»£ç æ›´æ˜“è¯»äº†å—ï¼Ÿæˆ‘æ›´å€¾å‘äºä½¿ç”¨ifè€Œéunlessï¼Œç”¨è‚¯å®šçš„è¡¨è¾¾å¼å¤šè¿‡è‚¯å®šçš„è¡¨è¾¾å¼ã€‚å®åœ¨ä¸è¡Œå°±æ·»åŠ ä¸ªåæ„çš„æ–¹æ³•ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨Useræ¨¡å‹é‡ŒåŠ çš„é‚£ä¸ªã€‚&lt;/p&gt;

&lt;h3&gt;æ²¡æœ‰éµå¾ªâ€œå‘½ä»¤ï¼Œä¸è¦å»è¯¢é—®â€åŸåˆ™&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;ä¸å¥½çš„&lt;/strong&gt;&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="c1"&gt;# app/models/user.rb&lt;/span&gt;
&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;User&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;enable!&lt;/span&gt;
    &lt;span class="n"&gt;update&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;enabled: &lt;/span&gt;&lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="c1"&gt;# app/controllers/users_controller.rb&lt;/span&gt;
&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;UsersController&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ApplicationController&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;enable&lt;/span&gt;
    &lt;span class="n"&gt;user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;User&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;find&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:id&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;

    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;disabled?&lt;/span&gt;
      &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;enable!&lt;/span&gt;
      &lt;span class="n"&gt;message&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;"User enabled"&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;
      &lt;span class="n"&gt;message&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;"User already disabled"&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;

    &lt;span class="n"&gt;redirect_to&lt;/span&gt; &lt;span class="n"&gt;user_path&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="ss"&gt;notice: &lt;/span&gt;&lt;span class="n"&gt;message&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™é‡Œçš„é—®é¢˜æ˜¯åœ¨ä¸æ°å½“çš„åœ°æ–¹å‡ºç°äº†æ§åˆ¶é€»è¾‘ã€‚ä½ å…ˆåˆ¤æ–­äº†ç”¨æˆ·æ˜¯å¦æ˜¯ä¸å¯ç”¨ï¼Œå¦‚æœçš„ç¡®ä¸å¯ç”¨ï¼Œå°±å¯ç”¨è¿™ä¸ªç”¨æˆ·ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å¥½çš„&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æ¯”è¾ƒå¥½çš„æ”¹åŠæ³•æ˜¯æŠŠæ§åˆ¶é€»è¾‘æ”¾åˆ°enable!æ–¹æ³•é‡Œã€‚&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="c1"&gt;# app/models/user.rb&lt;/span&gt;
&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;User&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;enable!&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;disabled?&lt;/span&gt;
      &lt;span class="n"&gt;update&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;enabled: &lt;/span&gt;&lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="c1"&gt;# app/controllers/users_controller.rb&lt;/span&gt;
&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;UsersController&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ApplicationController&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;enable&lt;/span&gt;
    &lt;span class="n"&gt;user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;User&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;find&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:id&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;

    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;enable!&lt;/span&gt;
      &lt;span class="n"&gt;message&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;"User enabled"&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;
      &lt;span class="n"&gt;message&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;"User already disabled"&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;

    &lt;span class="n"&gt;redirect_to&lt;/span&gt; &lt;span class="n"&gt;user_path&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="ss"&gt;notice: &lt;/span&gt;&lt;span class="n"&gt;message&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç°åœ¨æ§åˆ¶å™¨ä¸ç”¨å…³å¿ƒuseréœ€è¦æ»¡è¶³ä½•ç§æ¡ä»¶æ‰ä¼šè¢«å¯ç”¨ã€‚ç›¸å…³çš„åˆ¤æ–­ç”±Useræ¨¡å‹å’Œenableï¼æ–¹æ³•æ¥å¤„ç†ã€‚&lt;/p&gt;

&lt;h3&gt;ä½¿ç”¨å¤æ‚çš„æ¡ä»¶&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;ä¸å¥½çš„&lt;/strong&gt;&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="c1"&gt;# app/controllers/posts_controller.rb&lt;/span&gt;
&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;PostsController&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ApplicationController&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;destroy&lt;/span&gt;
    &lt;span class="n"&gt;post&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Post&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;find&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:id&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;

    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;enabled?&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;own_post?&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;||&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;admin?&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;destroy&lt;/span&gt;
      &lt;span class="n"&gt;message&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;"Post destroyed."&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;
      &lt;span class="n"&gt;message&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;"You're not allow to destroy this post."&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;

    &lt;span class="n"&gt;redirect_to&lt;/span&gt; &lt;span class="n"&gt;posts_path&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;notice: &lt;/span&gt;&lt;span class="n"&gt;message&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ¡ä»¶è¡¨è¾¾å¼å¼„çš„å¤ªè¿‡å¤æ‚äº†ï¼Œå®é™…ä¸Šè¿™é‡Œåªæƒ³çŸ¥é“ä¸€ä»¶äº‹ï¼šç”¨æˆ·å¯ä»¥åˆ æ‰postå—ï¼Ÿ&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å¥½çš„&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ä»ä¸Šé¢çš„ä»£ç æˆ‘ä»¬å¯ä»¥äº†è§£åˆ°ï¼Œä¸€ä¸ªç”¨æˆ·éœ€è¦æ˜¯postçš„æ‰€æœ‰è€…æˆ–è€…è¿™ä¸ªç”¨æˆ·æ˜¯ç®¡ç†å‘˜ï¼Œå¹¶ä¸”postæœ¬èº«ä¹Ÿæ˜¯å¯ç”¨çš„ï¼Œæ‰å¯ä»¥åˆ é™¤è¿™ä¸ªpostã€‚æœ€å¥½çš„åšæ³•å°±æ˜¯ï¼ŒæŠŠè¿™äº›æ¡ä»¶æŠ½å–æˆä¸€ä¸ªæ—¥åå¯ä»¥å¤ç”¨çš„æ–¹æ³•ã€‚&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="c1"&gt;# app/models/user.rb&lt;/span&gt;
&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;User&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;can_destroy_post?&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;enabled?&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;own_post?&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;||&lt;/span&gt; &lt;span class="n"&gt;admin?&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="c1"&gt;# app/controllers/posts_controller.rb&lt;/span&gt;
&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;PostsController&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ApplicationController&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;destroy&lt;/span&gt;
    &lt;span class="n"&gt;post&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;Post&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;find&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="ss"&gt;:id&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;

    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;can_destroy_post?&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="n"&gt;post&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;destroy&lt;/span&gt;
      &lt;span class="n"&gt;message&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;"Post destroyed."&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;
      &lt;span class="n"&gt;message&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;"You're not allow to destroy this post."&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;

    &lt;span class="n"&gt;redirect_to&lt;/span&gt; &lt;span class="n"&gt;posts_path&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;notice: &lt;/span&gt;&lt;span class="n"&gt;message&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ¯å½“æ¡ä»¶è¡¨è¾¾å¼é‡Œå‡ºç°äº†&amp;amp;&amp;amp;æˆ–è€…||ï¼Œå°±åº”è¯¥æŠŠå®ƒä»¬æå–ä¸ºæ–¹æ³•ï¼Œä»¥å¤‡ä»¥åå¤ç”¨ã€‚&lt;/p&gt;

&lt;h3&gt;åœ¨æ¨¡å‹çš„å®ä¾‹æ–¹æ³•é‡Œï¼Œæœ¬æ¥ä¸éœ€è¦çš„æ—¶å€™ä½¿ç”¨äº†â€œself.â€&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;ä¸å¥½çš„&lt;/strong&gt;&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="c1"&gt;# app/models/user.rb&lt;/span&gt;
&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;User&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;full_name&lt;/span&gt;
    &lt;span class="s2"&gt;"&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="nb"&gt;self&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;first_name&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt; &lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="nb"&gt;self&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;last_name&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;"&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™æ®µä»£ç å¹¶ä¸å¤æ‚ä½†æ˜¯é‡Œé¢å¹¶ä¸éœ€è¦ä½¿ç”¨â€œself.â€ã€‚æŠŠâ€œself.â€å»æ‰ä¼šä½¿ä»£ç æ›´ç®€æ´ä¸”ä¸å½±å“å¯ç”¨æ€§ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å¥½çš„&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;åœ¨æ¨¡å‹é‡Œï¼Œåªæœ‰åœ¨å®ä¾‹æ–¹æ³•é‡Œéœ€è¦èµ‹å€¼æ—¶ï¼Œæ‰ä¼šç”¨åˆ°â€œself.â€ï¼Œå¦åˆ™é€šç¯‡çš„â€œself.â€åªä¼šå¾’å¢ä»£ç å¤æ‚åº¦ã€‚&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="c1"&gt;# app/models/user.rb&lt;/span&gt;
&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;User&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;full_name&lt;/span&gt;
    &lt;span class="s2"&gt;"&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;first_name&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt; &lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;last_name&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;"&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;ä½¿ç”¨æ¡ä»¶è¡¨è¾¾å¼å¹¶ä¸”è¿”å›äº†æ¡ä»¶&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;ä¸å¥½çš„&lt;/strong&gt;&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="c1"&gt;# app/models/user.rb&lt;/span&gt;
&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;User&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;full_name&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nb"&gt;name&lt;/span&gt;
      &lt;span class="nb"&gt;name&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;
      &lt;span class="s2"&gt;"No name"&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æˆ–è€…&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="c1"&gt;# app/models/user.rb&lt;/span&gt;
&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;User&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;full_name&lt;/span&gt;
    &lt;span class="nb"&gt;name&lt;/span&gt; &lt;span class="p"&gt;?&lt;/span&gt; &lt;span class="nb"&gt;name&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"No name"&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™æ®µä»£ç çš„é—®é¢˜åœ¨äºï¼šåœ¨ä¸éœ€è¦çš„åœ°æ–¹æ·»åŠ äº†æ§åˆ¶è¯­å¥ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å¥½çš„&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æœ‰ç§æ›´ç®€ä¾¿çš„å¤„ç†æ–¹å¼ä¹Ÿèƒ½è¾¾åˆ°åŒæ ·æ•ˆæœ&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="c1"&gt;# app/models/user.rb&lt;/span&gt;
&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;User&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="no"&gt;ActiveRecord&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="no"&gt;Base&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;full_name&lt;/span&gt;
    &lt;span class="nb"&gt;name&lt;/span&gt; &lt;span class="o"&gt;||&lt;/span&gt; &lt;span class="s2"&gt;"No name"&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç®€å•æ¥è¯´è¿™æ®µä»£ç ä¼šåœ¨nameä¸ä¸ºfalseæˆ–nilæ—¶å°†å…¶è¿”å›ï¼Œå¦åˆ™è¿”å›&amp;quot;No name&amp;quot;.&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨å¾—å½“çš„è¯ï¼Œ||å’Œ&amp;amp;&amp;amp;è¿™äº›æ“ä½œç¬¦ä¼šå¯¹æå‡ä½ çš„ä»£ç å“è´¨æä¾›å·¨å¤§åŠ©åŠ›ã€‚&lt;/p&gt;

&lt;h3&gt;åœ¨è§†å›¾å±‚ä½¿ç”¨è¡Œå†…æ ·å¼&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;ä¸å¥½çš„&lt;/strong&gt;&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="o"&gt;&amp;lt;!--&lt;/span&gt; &lt;span class="n"&gt;app&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;views&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;projects&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;show&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;html&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;erb&lt;/span&gt; &lt;span class="o"&gt;--&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;.&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;
&lt;span class="nf"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;h3&lt;/span&gt; &lt;span class="n"&gt;style&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"font-size:20px;letter-spacing:normal;color:#95d60a;line-height:100%;margin:0;font-family:'Proxima Nova';"&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="no"&gt;SECRET&lt;/span&gt; &lt;span class="no"&gt;PROJECT&lt;/span&gt;
&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="sr"&gt;/h3&amp;gt;
...
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™é‡Œæˆ‘ä»¬åªåˆ—å‡ºä¸€ä¸ªæ ‡ç­¾ï¼Œæ‰€æœ‰çš„æ ·å¼éƒ½å†™åœ¨äº†æ ‡ç­¾é‡Œã€‚ç°åœ¨ï¼Œè¯·è®¾æƒ³ä¸€ä¸‹ï¼Œå¦‚æœæ‰€æœ‰çš„æ ‡ç­¾éƒ½æ¥æ”¶è¡Œå†…æ ·å¼ã€‚è¿™ä¼šæŠŠä½ çš„HTMLå˜å¾—å’Œå…¶éš¾åº¦ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œæ¯å½“ä½ éœ€è¦å¼•å…¥å¦ä¸€ä¸ªåŒæ ·çš„h3å…ƒç´ æ—¶ï¼Œå°†ä¸å¾—ä¸æŠŠåŒæ ·ä»£ç ç…§æ¬ä¸€è¾¹ï¼Œé€ æˆå†—ä½™ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å¥½çš„&lt;/strong&gt;&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="sr"&gt;//&lt;/span&gt; &lt;span class="n"&gt;app&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;assets&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;stylesheets&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;application&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;css&lt;/span&gt;
&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;project&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="n"&gt;font&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="ss"&gt;size: &lt;/span&gt;&lt;span class="mi"&gt;20&lt;/span&gt;&lt;span class="n"&gt;px&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="n"&gt;letter&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="ss"&gt;spacing: &lt;/span&gt;&lt;span class="n"&gt;normal&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="ss"&gt;color: &lt;/span&gt;&lt;span class="c1"&gt;#95d60a;&lt;/span&gt;
    &lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="ss"&gt;height: &lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="ss"&gt;margin: &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="n"&gt;font&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;family&lt;/span&gt;&lt;span class="ss"&gt;:'Proxima Nova'&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="o"&gt;&amp;lt;!--&lt;/span&gt; &lt;span class="n"&gt;app&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;views&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;projects&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;show&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;html&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;erb&lt;/span&gt; &lt;span class="o"&gt;--&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;.&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;
&lt;span class="nf"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;h3&lt;/span&gt; &lt;span class="k"&gt;class&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"project-title"&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="no"&gt;SECRET&lt;/span&gt; &lt;span class="no"&gt;PROJECT&lt;/span&gt;
&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="sr"&gt;/h3&amp;gt;
...
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç°åœ¨æˆ‘ä¹ˆå¯ä»¥å¤ç”¨æ ·å¼äº†ï¼Œå¹¶ä¸”HTMLçš„å¯è¯»æ€§ä¹Ÿæœ‰æ‰€æé«˜ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;æ³¨æ„ï¼š&lt;/strong&gt;è¿™åªæ˜¯ä¸ªç®€å•çš„èŒƒä¾‹ï¼Œå®é™…åº”ç”¨æ—¶ä½ åº”è¯¥æŠŠCSSæ‹†åˆ†æˆå¤šä¸ªå°æ–‡ä»¶ï¼Œå¹¶é€šè¿‡application.cssæ¥åŠ è½½è¿™äº›æ–‡ä»¶ã€‚å¦å¤–åªæœ‰åœ¨emailæ¨¡æ¿é‡Œï¼Œæ‰ä¼šç”¨åˆ°è¡Œå†…æ ·å¼ã€‚&lt;/p&gt;

&lt;p&gt;###åœ¨è§†å›¾å±‚ä½¿ç”¨JavaScript&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;ä¸å¥½çš„&lt;/strong&gt;&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="o"&gt;&amp;lt;!--&lt;/span&gt; &lt;span class="n"&gt;app&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;views&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;questions&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;show&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;html&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;erb&lt;/span&gt; &lt;span class="o"&gt;--&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;.&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;
&lt;span class="nf"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;textarea&lt;/span&gt; &lt;span class="n"&gt;rows&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"4"&lt;/span&gt; &lt;span class="n"&gt;cols&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"50"&lt;/span&gt; &lt;span class="k"&gt;class&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'wysihtml5'&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="no"&gt;Insert&lt;/span&gt; &lt;span class="n"&gt;your&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt; &lt;span class="n"&gt;details&lt;/span&gt; &lt;span class="n"&gt;here&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;
&lt;span class="nf"&gt;&amp;lt;&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;textarea&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;.&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;
&lt;span class="nf"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;script&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;document&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nf"&gt;ready&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(){&lt;/span&gt;
  &lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'textarea.wysihtml5'&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nf"&gt;wysihtml5&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;
    &lt;span class="s2"&gt;"font-styles"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="sr"&gt;//&lt;/span&gt;&lt;span class="no"&gt;Font&lt;/span&gt; &lt;span class="n"&gt;styling&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;g&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt; &lt;span class="nf"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;h2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;etc&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="no"&gt;Default&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;
    &lt;span class="s2"&gt;"emphasis"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="sr"&gt;//&lt;/span&gt;&lt;span class="no"&gt;Italics&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;bold&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;etc&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="no"&gt;Default&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;
    &lt;span class="s2"&gt;"lists"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="sr"&gt;//&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="no"&gt;Un&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="n"&gt;ordered&lt;/span&gt; &lt;span class="n"&gt;lists&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;g&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="no"&gt;Bullets&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="no"&gt;Numbers&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="no"&gt;Default&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;
    &lt;span class="s2"&gt;"html"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="sr"&gt;//&lt;/span&gt;&lt;span class="no"&gt;Button&lt;/span&gt; &lt;span class="n"&gt;which&lt;/span&gt; &lt;span class="n"&gt;allows&lt;/span&gt; &lt;span class="n"&gt;you&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;edit&lt;/span&gt; &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;generated&lt;/span&gt; &lt;span class="no"&gt;HTML&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="no"&gt;Default&lt;/span&gt; &lt;span class="kp"&gt;false&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;
    &lt;span class="s2"&gt;"link"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="sr"&gt;//&lt;/span&gt;&lt;span class="no"&gt;Button&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;insert&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="n"&gt;link&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="no"&gt;Default&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;
    &lt;span class="s2"&gt;"image"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="sr"&gt;//&lt;/span&gt;&lt;span class="no"&gt;Button&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;insert&lt;/span&gt; &lt;span class="n"&gt;an&lt;/span&gt; &lt;span class="n"&gt;image&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="no"&gt;Default&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;
    &lt;span class="s2"&gt;"color"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt; &lt;span class="sr"&gt;//&lt;/span&gt;&lt;span class="no"&gt;Button&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;change&lt;/span&gt; &lt;span class="n"&gt;color&lt;/span&gt; &lt;span class="n"&gt;of&lt;/span&gt; &lt;span class="n"&gt;font&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="no"&gt;Default&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;
  &lt;span class="p"&gt;});&lt;/span&gt;
&lt;span class="p"&gt;});&lt;/span&gt;
&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;script&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™é‡Œçš„é€»è¾‘å’Œç‰¹å®šé¡µé¢è€¦åˆåœ¨ä¸€èµ·ï¼Œå¯¼è‡´ä»£ç ä¸å¯å¤ç”¨ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å¥½çš„&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Railsé‡Œé¢æœ‰ä¸“é—¨ç”¨äºç»„ç»‡å’Œå­˜æ”¾javascriptä»£ç çš„åœ°æ–¹ï¼šâ€œapp/assets/javascripts/â€ã€‚&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="sr"&gt;//&lt;/span&gt; &lt;span class="n"&gt;app&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;assets&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;javascripts&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;application&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;js&lt;/span&gt;
&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;.&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;
&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;document&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nf"&gt;ready&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(){&lt;/span&gt;
  &lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'textarea.wysihtml5'&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nf"&gt;wysihtml5&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;
    &lt;span class="s2"&gt;"font-styles"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="sr"&gt;//&lt;/span&gt;&lt;span class="no"&gt;Font&lt;/span&gt; &lt;span class="n"&gt;styling&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;g&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt; &lt;span class="nf"&gt;h1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;h2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;etc&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="no"&gt;Default&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;
    &lt;span class="s2"&gt;"emphasis"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="sr"&gt;//&lt;/span&gt;&lt;span class="no"&gt;Italics&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;bold&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;etc&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="no"&gt;Default&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;
    &lt;span class="s2"&gt;"lists"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="sr"&gt;//&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="no"&gt;Un&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="n"&gt;ordered&lt;/span&gt; &lt;span class="n"&gt;lists&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;g&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="no"&gt;Bullets&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="no"&gt;Numbers&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="no"&gt;Default&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;
    &lt;span class="s2"&gt;"html"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="sr"&gt;//&lt;/span&gt;&lt;span class="no"&gt;Button&lt;/span&gt; &lt;span class="n"&gt;which&lt;/span&gt; &lt;span class="n"&gt;allows&lt;/span&gt; &lt;span class="n"&gt;you&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;edit&lt;/span&gt; &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;generated&lt;/span&gt; &lt;span class="no"&gt;HTML&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="no"&gt;Default&lt;/span&gt; &lt;span class="kp"&gt;false&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;
    &lt;span class="s2"&gt;"link"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="sr"&gt;//&lt;/span&gt;&lt;span class="no"&gt;Button&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;insert&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="n"&gt;link&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="no"&gt;Default&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;
    &lt;span class="s2"&gt;"image"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="sr"&gt;//&lt;/span&gt;&lt;span class="no"&gt;Button&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;insert&lt;/span&gt; &lt;span class="n"&gt;an&lt;/span&gt; &lt;span class="n"&gt;image&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="no"&gt;Default&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;
    &lt;span class="s2"&gt;"color"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt; &lt;span class="sr"&gt;//&lt;/span&gt;&lt;span class="no"&gt;Button&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;change&lt;/span&gt; &lt;span class="n"&gt;color&lt;/span&gt; &lt;span class="n"&gt;of&lt;/span&gt; &lt;span class="n"&gt;font&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="no"&gt;Default&lt;/span&gt; &lt;span class="kp"&gt;true&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;
  &lt;span class="p"&gt;});&lt;/span&gt;
&lt;span class="p"&gt;});&lt;/span&gt;
&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;.&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="o"&gt;&amp;lt;!--&lt;/span&gt; &lt;span class="n"&gt;app&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;views&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;questions&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;show&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;html&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;erb&lt;/span&gt; &lt;span class="o"&gt;--&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;.&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;
&lt;span class="nf"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;textarea&lt;/span&gt; &lt;span class="n"&gt;rows&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"4"&lt;/span&gt; &lt;span class="n"&gt;cols&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"50"&lt;/span&gt; &lt;span class="k"&gt;class&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'wysihtml5'&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="no"&gt;Insert&lt;/span&gt; &lt;span class="n"&gt;your&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt; &lt;span class="n"&gt;details&lt;/span&gt; &lt;span class="n"&gt;here&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;
&lt;span class="nf"&gt;&amp;lt;&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;textarea&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;.&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç°åœ¨æˆ‘ä»¬å¯ä»¥åœ¨viewå±‚ä»»ä½•åœ°æ–¹ç”¨è¿™æ®µä»£ç äº†ã€‚åªéœ€è¦é¡µé¢ä¸Šæœ‰ä¸€ä¸ªå¸¦æœ‰wysihtml5è¿™ä¸ªclassçš„textareaï¼Œåˆšæ‰çš„é‚£æ®µjså°±ä¼šè¢«æ‰§è¡Œã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;æ³¨æ„ï¼š&lt;/strong&gt;è¿™åªæ˜¯ä¸ªç®€å•çš„èŒƒä¾‹ï¼Œå®é™…åº”ç”¨æ—¶éœ€è¦è€ƒè™‘æ˜¯å¦éœ€è¦æŠŠä½ çš„JavaScriptæ‹†åˆ†æˆè‹¥å¹²å°çš„æ–‡ä»¶ï¼Œå¹¶é€šè¿‡application.jsæ¥åŠ è½½è¿™äº›æ–‡ä»¶ã€‚å¦å¤–ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯CoffeeScriptè€ŒéJavaScriptï¼Œè¯·åšæŒä¸è¦æŠŠCoffeeScriptä¸æ™®é€šJavaScriptåœ¨ä¸€èµ·æ··å†™ã€‚&lt;/p&gt;

&lt;h3&gt;è°ƒç”¨æ–¹æ³•æ—¶æŠŠå¦ä¸€ä¸ªæ–¹æ³•çš„è°ƒç”¨ä½œä¸ºå‚æ•°&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;ä¸å¥½çš„&lt;/strong&gt;&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="c1"&gt;# app/services/find_or_create_topic.rb&lt;/span&gt;
&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;FindOrCreateTopic&lt;/span&gt;
  &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;.&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;
  &lt;span class="nf"&gt;def&lt;/span&gt; &lt;span class="nb"&gt;self&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;perform&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;find&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;sluggify&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;name&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="o"&gt;||&lt;/span&gt; &lt;span class="n"&gt;create&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;.&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;
&lt;span class="nf"&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™æ®µä»£ç é‡Œè°ƒç”¨äº†findæ–¹æ³•å¹¶ä¼ å…¥äº†2ä¸ªå‚æ•°ï¼Œé¦–å‚æ•°ä¸ºuserï¼Œç¬¬äºŒä¸ªå‚æ•°åˆ™æ˜¯ç›´æ¥è°ƒç”¨äº†sluggifyè¿™ä¸ªæ–¹æ³•å¹¶æŠŠnameä½œä¸ºå‚æ•°ä¼ ç»™sluggifyã€‚ä½ ä¹Ÿè®¸ä¼šæœ‰ç–‘é—®ï¼Œè¿™ä¹ˆå†™æœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Ÿæˆ‘æ˜æ˜å®Œå…¨èƒ½å¤Ÿçœ‹æ‡‚è¿™æ®µä»£ç å‘€ã€‚æ˜¯çš„ï¼Œä»£ç ä¹Ÿè®¸ä¸éš¾ç†è§£ï¼Œä½†æ˜¯æ¯æ¬¡åˆ°è¿™é‡Œä½ éƒ½éœ€è¦è‡ªå·±åšä¸€ç‚¹è„‘ç­‹è½¬æ¢ï¼Œè€Œè¿™æ­£æ˜¯æˆ‘ä¸€ç›´æåŠ›æƒ³è¦é¿å…çš„ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å¥½çš„&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;é¿å…éœ€è¦è„‘ç­‹è½¬æ¢çš„ä¸€ä¸ªæ¯”è¾ƒæœ‰æ•ˆçš„åŠæ³•å°±æ˜¯ï¼šä½¿ç”¨æœ‰æ„ä¹‰çš„å˜é‡åã€‚&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="c1"&gt;# app/services/find_or_create_topic.rb&lt;/span&gt;
&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;FindOrCreateTopic&lt;/span&gt;
  &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;.&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;
  &lt;span class="nf"&gt;def&lt;/span&gt; &lt;span class="nb"&gt;self&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;perform&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;slug&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;sluggify&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;find&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;slug&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;||&lt;/span&gt; &lt;span class="n"&gt;create&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;.&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;
&lt;span class="nf"&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™æ ·åšå¯ä»¥é¿å…è„‘ç­‹è½¬æ¢ã€‚æ¢ç”¨å«ä¹‰æ˜ç¡®çš„å˜é‡åä¹‹åï¼Œæ¯å½“ä½ å†è°ƒç”¨findæ–¹æ³•ï¼Œå°±ä¼šçŸ¥é“findæ¥å—ä¸€ä¸ªuserå’Œä¸€ä¸ªslugåšå‚æ•°ã€‚&lt;/p&gt;

&lt;h3&gt;æ²¡æœ‰ä½¿ç”¨ç±»æ¥éš”ç¦»Rake Tasks&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;ä¸å¥½çš„&lt;/strong&gt;&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="c1"&gt;# lib/tasks/recalculate_badges_for_users.rake&lt;/span&gt;
&lt;span class="n"&gt;namespace&lt;/span&gt; &lt;span class="ss"&gt;:users&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;

  &lt;span class="n"&gt;desc&lt;/span&gt; &lt;span class="s2"&gt;"Recalculates Badges for Users"&lt;/span&gt;
  &lt;span class="n"&gt;task&lt;/span&gt; &lt;span class="ss"&gt;recalculate_badges: :environment&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="n"&gt;user_count&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;User&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;count&lt;/span&gt;

    &lt;span class="no"&gt;User&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;find_each&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
      &lt;span class="nb"&gt;puts&lt;/span&gt; &lt;span class="s2"&gt;"&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;index&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;user_count&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt; Recalculating Badges for: &lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;email&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;"&lt;/span&gt;

      &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;questions_with_negative_votes&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="o"&gt;||&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;answers_with_negative_votes&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
        &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;grant_badge&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'Critic'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="k"&gt;end&lt;/span&gt;

      &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;answers&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;find_each&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;answer&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
        &lt;span class="n"&gt;question&lt;/span&gt;   &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;answer&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;question&lt;/span&gt;
        &lt;span class="k"&gt;next&lt;/span&gt; &lt;span class="k"&gt;unless&lt;/span&gt; &lt;span class="n"&gt;answer&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;

        &lt;span class="n"&gt;days&lt;/span&gt;       &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;answer&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;created_at&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;created_at&lt;/span&gt;
        &lt;span class="n"&gt;days_count&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;days&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;day&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nf"&gt;round&lt;/span&gt;

        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;days_count&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;=&lt;/span&gt; &lt;span class="mi"&gt;60&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;vote_count&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;=&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
          &lt;span class="n"&gt;grant_badge&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'Necromancer'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt;
        &lt;span class="k"&gt;end&lt;/span&gt;
      &lt;span class="k"&gt;end&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™ä¸ªrake taskæœ‰é—®é¢˜å¤šå¤šã€‚æœ€ä¸»è¦çš„é—®é¢˜æ˜¯ï¼Œè¿™ä¸ªrakeå¤ªé•¿äº†è€Œä¸”ä¸å¥½æµ‹è¯•ã€‚ä»£ç å†™çš„åˆä¸€çœ‹ä¹Ÿå¾ˆéš¾ç†è§£ã€‚ä½ åªå¥½ç›¸ä¿¡è¿™ä¸ªtaskçš„ç¡®æ˜¯ä¸ºç”¨æˆ·é‡æ–°è®¡ç®—å¥–ç« ç³»ç»Ÿçš„ï¼Œå› ä¸ºå®ƒä¸Šé¢æè¿°å°±è¿™ä¹ˆå†™çš„ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å¥½çš„&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;è§£å†³è¿™ä¸ªé—®é¢˜æœ€å¥½çš„åŠæ³•å°±æ˜¯ï¼ŒæŠŠä¸šåŠ¡é€»è¾‘æŒªåˆ°ä¸€ä¸ªç‰¹å®šçš„ç±»é‡Œé¢ã€‚æ‰€ä»¥ï¼Œè®©æˆ‘ä»¬æ–°å»ºä¸ªç±»æ¥æå®šå®ƒå§ã€‚&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="c1"&gt;# app/services/recalculate_badge.rb&lt;/span&gt;
&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;RecalculateBadge&lt;/span&gt;
  &lt;span class="kp"&gt;attr_reader&lt;/span&gt; &lt;span class="ss"&gt;:user&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;initialize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="vi"&gt;@user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;user&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;grant_citric&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;grant_citric?&lt;/span&gt;
      &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;grant_badge&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'Critic'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;grant_necromancer&lt;/span&gt;
    &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;answers&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;find_each&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;answer&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
      &lt;span class="n"&gt;question&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;answer&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;question&lt;/span&gt;
      &lt;span class="k"&gt;next&lt;/span&gt; &lt;span class="k"&gt;unless&lt;/span&gt; &lt;span class="n"&gt;answer&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;

      &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;grant_necromancer?&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;answer&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;grant_badge&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'Necromancer'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt;
      &lt;span class="k"&gt;end&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

  &lt;span class="kp"&gt;protected&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;grant_citric?&lt;/span&gt;
      &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;questions_with_negative_votes&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;||&lt;/span&gt;
      &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;answers_with_negative_votes&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;days_count&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;answer&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="n"&gt;days&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;answer&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;created_at&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;created_at&lt;/span&gt;
      &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;days&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;day&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nf"&gt;round&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;grant_necromancer?&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;answer&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;days_count&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;answer&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;=&lt;/span&gt; &lt;span class="mi"&gt;60&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt;
      &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;question&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;vote_count&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;=&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="c1"&gt;# lib/tasks/recalculate_badges_for_users.rake&lt;/span&gt;
&lt;span class="n"&gt;namespace&lt;/span&gt; &lt;span class="ss"&gt;:users&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;

  &lt;span class="n"&gt;desc&lt;/span&gt; &lt;span class="s2"&gt;"Recalculates Badges for Users"&lt;/span&gt;
  &lt;span class="n"&gt;task&lt;/span&gt; &lt;span class="ss"&gt;recalculate_badges: :environment&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="n"&gt;user_count&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;User&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;count&lt;/span&gt;

    &lt;span class="no"&gt;User&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;find_each&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;
      &lt;span class="nb"&gt;puts&lt;/span&gt; &lt;span class="s2"&gt;"&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;index&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;/&lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;user_count&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt; Recalculating Badges for: &lt;/span&gt;&lt;span class="si"&gt;#{&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;email&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;"&lt;/span&gt;
      &lt;span class="n"&gt;task&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="no"&gt;RecalculateBadge&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;new&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="n"&gt;task&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;grant_citric&lt;/span&gt;
      &lt;span class="n"&gt;task&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;grant_necromancer&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
  &lt;span class="k"&gt;end&lt;/span&gt;

&lt;span class="k"&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¦‚ä½ æ‰€è§ï¼Œç°åœ¨è¿™ä¸ªrake taskå¯è¯»æ€§è¦å¥½çš„å¤šï¼Œè€Œä¸”è¿˜å¯ä»¥å•ç‹¬æµ‹è¯•æ¯ä¸€ç§æ‰¹å‡†å¾½ç« çš„æ–¹æ³•ã€‚é™¤æ­¤ä»¥å¤–æˆ‘ä¹ˆä¹Ÿå¯ä»¥åœ¨æœ‰éœ€è¦æ—¶å¤ç”¨è¿™ä¸ªç±»ã€‚å½“ç„¶è¿™æ®µä»£ç åªæ˜¯ç‚¹åˆ°å³æ­¢ï¼Œè¯¸ä½å¯ä»¥å†åšè¿›ä¸€æ­¥ä¼˜åŒ–ã€‚&lt;/p&gt;

&lt;h3&gt;æ²¡æœ‰éµå¾ª Sandi Metz çš„è§„åˆ™&lt;/h3&gt;

&lt;ol&gt;
&lt;li&gt;æ¯ä¸ªç±»ä»£ç ä¸å¯ä»¥è¶…è¿‡100è¡Œ&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªæ–¹æ³•ä»£ç ä¸å¯ä»¥è¶…è¿‡5è¡Œ&lt;/li&gt;
&lt;li&gt;æ–¹æ³•å‚æ•°ä¸å¯ä»¥è¶…è¿‡4ä¸ªï¼Œhashé¡¹ä¹ŸåŒ…æ‹¬åœ¨å†…&lt;/li&gt;
&lt;li&gt;æ§åˆ¶å™¨ä¹‹å¯ä»¥åˆå§‹åŒ–ä¸€ä¸ªå¯¹è±¡ã€‚è€Œä¸”è§†å›¾å±‚åªå¯ä»¥ä½¿ç”¨ä¸€ä¸ªå®ä¾‹å˜é‡ï¼Œå¹¶ä¸”åªå¯ä»¥åœ¨è¿™ä¸ªå¯¹è±¡ä¸Šè°ƒç”¨æ–¹æ³•ï¼ˆ@object.collaborator.valueè¿™ç§æ˜¯ä¸å¯ä»¥çš„ï¼‰ã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;æ›´å¤šå…³äºSandi Metzçš„è§„åˆ™è¯·ç§»æ­¥è‡³&lt;a href="http://robots.thoughtbot.com/"&gt;thoughtbot&lt;/a&gt;,å‚é˜…&lt;a href="http://robots.thoughtbot.com/sandi-metz-rules-for-developers"&gt;Sandi Metz&amp;#39; Rules For Developers&lt;/a&gt;è¿™ç¯‡åšæ–‡ã€‚&lt;/p&gt;
</content>
  </entry>
</feed>
